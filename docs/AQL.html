<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="description" content="openEHR Archetype Query Language (AQL)">
<meta name="keywords" content="query, AQL, archetype, Xpath, openehr">
<title>Archetype Query Language (AQL)</title>
<link rel="stylesheet" href="https://specifications.openehr.org/styles/openehr.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_archetype_query_language_aql">Archetype Query Language (AQL)</a>
<ul class="sectlevel1">
<li><a href="#_amendment_record">Amendment Record</a></li>
<li><a href="#_acknowledgements">Acknowledgements</a>
<ul class="sectlevel2">
<li><a href="#_primary_author">Primary Author</a></li>
<li><a href="#_contributors">Contributors</a></li>
<li><a href="#_support">Support</a></li>
<li><a href="#_trademarks">Trademarks</a></li>
</ul>
</li>
<li><a href="#_preface">1. Preface</a>
<ul class="sectlevel2">
<li><a href="#_purpose">1.1. Purpose</a></li>
<li><a href="#_status">1.2. Status</a></li>
<li><a href="#_tools">1.3. Tools</a></li>
<li><a href="#_feedback">1.4. Feedback</a></li>
<li><a href="#_original_source">1.5. Original Source</a></li>
</ul>
</li>
<li><a href="#_overview">2. Overview</a>
<ul class="sectlevel2">
<li><a href="#_existing_query_languages">2.1. Existing Query Languages</a></li>
<li><a href="#_what_is_aql">2.2. What is AQL?</a></li>
<li><a href="#_aql_example">2.3. AQL example</a></li>
</ul>
</li>
<li><a href="#_aql_syntax_description">3. AQL Syntax Description</a>
<ul class="sectlevel2">
<li><a href="#_overview_2">3.1. Overview</a></li>
<li><a href="#_reserved_words_and_characters">3.2. Reserved words and characters</a></li>
<li><a href="#_openehr_path_syntax">3.3. openEHR path syntax</a></li>
<li><a href="#_variables">3.4. Variables</a>
<ul class="sectlevel3">
<li><a href="#_variable_syntax">3.4.1. Syntax</a></li>
</ul>
</li>
<li><a href="#_parameters">3.5. Parameters</a>
<ul class="sectlevel3">
<li><a href="#parameter_syntax">3.5.1. Syntax</a></li>
<li><a href="#_parameters_use_case">3.5.2. Parameters use case</a></li>
<li><a href="#_parameter_resolution">3.5.3. Parameter Resolution</a></li>
</ul>
</li>
<li><a href="#_predicates">3.6. Predicates</a>
<ul class="sectlevel3">
<li><a href="#_standard_predicate">3.6.1. Standard predicate</a></li>
<li><a href="#_archetype_predicate">3.6.2. Archetype predicate</a></li>
<li><a href="#_node_predicate">3.6.3. Node predicate</a></li>
</ul>
</li>
<li><a href="#_identified_paths">3.7. Identified Paths</a>
<ul class="sectlevel3">
<li><a href="#_identified_paths_syntax">3.7.1. Syntax</a></li>
</ul>
</li>
<li><a href="#_operators">3.8. Operators</a>
<ul class="sectlevel3">
<li><a href="#_comparison_operators">3.8.1. Comparison operators</a>
<ul class="sectlevel4">
<li><a href="#_like">3.8.1.1. LIKE</a></li>
<li><a href="#_matches">3.8.1.2. matches</a></li>
</ul>
</li>
<li><a href="#_logical_operators">3.8.2. Logical operators</a>
<ul class="sectlevel4">
<li><a href="#_and">3.8.2.1. AND</a></li>
<li><a href="#_or">3.8.2.2. OR</a></li>
<li><a href="#_not">3.8.2.3. NOT</a></li>
<li><a href="#_exists">3.8.2.4. EXISTS</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_functions">3.9. Functions</a>
<ul class="sectlevel3">
<li><a href="#_aggregate_functions">3.9.1. Aggregate functions</a>
<ul class="sectlevel4">
<li><a href="#_count">3.9.1.1. COUNT</a></li>
<li><a href="#_min">3.9.1.2. MIN</a></li>
<li><a href="#_max">3.9.1.3. MAX</a></li>
<li><a href="#_sum">3.9.1.4. SUM</a></li>
<li><a href="#_avg">3.9.1.5. AVG</a></li>
</ul>
</li>
<li><a href="#_string_functions">3.9.2. String functions</a>
<ul class="sectlevel4">
<li><a href="#_length">3.9.2.1. LENGTH</a></li>
<li><a href="#_contains">3.9.2.2. CONTAINS</a></li>
<li><a href="#_position">3.9.2.3. POSITION</a></li>
<li><a href="#_substring">3.9.2.4. SUBSTRING</a></li>
<li><a href="#_concat">3.9.2.5. CONCAT</a></li>
<li><a href="#_concat_ws">3.9.2.6. CONCAT_WS</a></li>
</ul>
</li>
<li><a href="#_numeric_functions">3.9.3. Numeric functions</a>
<ul class="sectlevel4">
<li><a href="#_abs">3.9.3.1. ABS</a></li>
<li><a href="#_mod">3.9.3.2. MOD</a></li>
<li><a href="#_ceil">3.9.3.3. CEIL</a></li>
<li><a href="#_floor">3.9.3.4. FLOOR</a></li>
<li><a href="#_round">3.9.3.5. ROUND</a></li>
</ul>
</li>
<li><a href="#_date_and_time_functions">3.9.4. Date and time functions</a>
<ul class="sectlevel4">
<li><a href="#_current_date">3.9.4.1. CURRENT_DATE</a></li>
<li><a href="#_current_time">3.9.4.2. CURRENT_TIME</a></li>
<li><a href="#_current_date_time_or_now">3.9.4.3. CURRENT_DATE_TIME or NOW</a></li>
<li><a href="#_current_timezone">3.9.4.4. CURRENT_TIMEZONE</a></li>
</ul>
</li>
<li><a href="#_other_functions">3.9.5. Other functions</a>
<ul class="sectlevel4">
<li><a href="#_terminology">3.9.5.1. TERMINOLOGY</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_expressions">3.10. Expressions</a>
<ul class="sectlevel3">
<li><a href="#_class_expressions">3.10.1. Class expressions</a></li>
<li><a href="#_identified_expression">3.10.2. Identified expression</a></li>
</ul>
</li>
<li><a href="#_constants">3.11. Constants</a></li>
<li><a href="#_built_in_types">3.12. Built-in Types</a>
<ul class="sectlevel3">
<li><a href="#_integer_data">3.12.1. Integer data</a></li>
<li><a href="#_real_data">3.12.2. Real data</a></li>
<li><a href="#_boolean_data">3.12.3. Boolean data</a></li>
<li><a href="#_string_data">3.12.4. String data</a></li>
<li><a href="#_dates_and_times">3.12.5. Dates and Times</a></li>
</ul>
</li>
<li><a href="#_query_structure">3.13. Query structure</a>
<ul class="sectlevel3">
<li><a href="#_overview_3">3.13.1. Overview</a></li>
<li><a href="#_from">3.13.2. FROM</a>
<ul class="sectlevel4">
<li><a href="#_from_syntax">3.13.2.1. Syntax</a></li>
<li><a href="#_containment">3.13.2.2. Containment</a></li>
</ul>
</li>
<li><a href="#_where">3.13.3. WHERE</a>
<ul class="sectlevel4">
<li><a href="#_where_syntax">3.13.3.1. Syntax</a></li>
</ul>
</li>
<li><a href="#_select">3.13.4. SELECT</a>
<ul class="sectlevel4">
<li><a href="#_select_syntax">3.13.4.1. Syntax</a></li>
<li><a href="#_top">3.13.4.2. TOP</a></li>
<li><a href="#_name_alias">3.13.4.3. Name alias</a></li>
</ul>
</li>
<li><a href="#_order_by">3.13.5. ORDER BY</a>
<ul class="sectlevel4">
<li><a href="#_order_by_syntax">3.13.5.1. Syntax</a></li>
</ul>
</li>
<li><a href="#_limit">3.13.6. LIMIT</a>
<ul class="sectlevel4">
<li><a href="#_limit_syntax">3.13.6.1. Syntax</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_result_structure">4. Result structure</a></li>
<li><a href="#_how_to_write_an_aql_query_statement_manually">5. Writing AQL manually</a>
<ul class="sectlevel2">
<li><a href="#_step_1_the_from_clause">5.1. Step 1. The FROM clause</a></li>
<li><a href="#_step_2_the_where_clause">5.2. Step 2. The WHERE clause</a></li>
<li><a href="#_step_3_the_select_clause">5.3. Step 3. The SELECT clause</a></li>
<li><a href="#_ordering_and_pagination">5.4. Ordering and pagination</a></li>
</ul>
</li>
<li><a href="#_aql_syntax_specification">6. AQL Syntax Specification</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="https://specifications.openehr.org/images/openEHR_logo_RGB.svg" alt="openEHR logo">
</div>
</div>
</div>
</div>
<h1 id="_archetype_query_language_aql" class="sect0"><a class="anchor" href="#_archetype_query_language_aql"></a>Archetype Query Language (AQL)</h1>
<div class="openblock partintro">
<div class="content">
<table class="tableblock frame-all grid-all fit-content spread">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2"><strong>Issuer</strong>: <a href="https://www.openehr.org/programs/specification" target="_blank" rel="noopener">openEHR Specification Program</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Release</strong>: QUERY latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Status</strong>: STABLE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Revision</strong>: <a href="#latest_issue">[latest_issue]</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Date</strong>: <a href="#latest_issue_date">[latest_issue_date]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Keywords</strong>: query, AQL, archetype, Xpath, openehr</p></td>
</tr>
</tbody>
</table>
<div class="imageblock text-center">
<div class="content">
<object type="image/svg+xml" data="openehr_block_diagram.svg" width="60%"><span class="alt">openEHR components</span></object>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">&#169; 2008 - 2021 The openEHR Foundation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><a href="https://www.openehr.org" target="_blank" rel="noopener">The openEHR Foundation</a> is an independent, non-profit foundation, facilitating the sharing of health records by consumers and clinicians via open specifications, clinical models and open platform implementations.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Licence</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="https://specifications.openehr.org/images/cc-by-nd-88x31.png" alt="image"></span> Creative Commons Attribution-NoDerivs 3.0 Unported. <a href="https://creativecommons.org/licenses/by-nd/3.0/" class="bare">https://creativecommons.org/licenses/by-nd/3.0/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Support</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issues: <a href="https://specifications.openehr.org/components/QUERY/open_issues" target="_blank" rel="noopener">Problem Reports</a><br>
 Web: <a href="https://specifications.openehr.org" target="_blank" rel="noopener">specifications.openEHR.org</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_amendment_record"><a class="anchor" href="#_amendment_record"></a>Amendment Record</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 54.5454%;">
<col style="width: 18.1818%;">
<col style="width: 18.1819%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Issue</th>
<th class="tableblock halign-left valign-top">Details</th>
<th class="tableblock halign-left valign-top">Raiser, Implementer</th>
<th class="tableblock halign-left valign-top">Completed</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Release 1.1.0 (unreleased)</strong></p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="latest_issue"></a>1.1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECQUERY-8" target="_blank" rel="noopener">SPECQUERY-8</a> Correct numerous minor typographical and formatting errors. Improve the wording and readability.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S Iancu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="latest_issue_date"></a>10 Jan 2021</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECQUERY-28" target="_blank" rel="noopener">SPECQUERY-28</a> Add support for built-in functions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S Iancu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 Jan 2021</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECQUERY-3" target="_blank" rel="noopener">SPECQUERY-3</a> Add support for constants (fixed values) in column expression.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D Bosca,<br>
 S Iancu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12 Dec 2020</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECQUERY-7" target="_blank" rel="noopener">SPECQUERY-7</a> Add support for <code>NOT CONTAINS</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T Beale,<br>
 S Iancu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12 Dec 2020</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECQUERY-12" target="_blank" rel="noopener">SPECQUERY-12</a> Improve terminology support by adding a new <code>TERMINOLOGY</code> function.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L Marco-Ruiz,<br>
 B Næss,<br>
 H Frankel<br>
 B Fabjan,<br>
 I McNicoll,<br>
 S Iancu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24 Nov 2020</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECQUERY-25" target="_blank" rel="noopener">SPECQUERY-25</a> Add support for aggregate functions like <code>COUNT</code>, <code>SUM</code>, etc (<a href="https://specifications.openehr.org/tickets/SPECPR-358" target="_blank" rel="noopener">SPECPR-358</a>).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S Iancu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">23 Nov 2020</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECQUERY-17" target="_blank" rel="noopener">SPECQUERY-17</a> Add support for <code>LIKE</code> operator (<a href="https://specifications.openehr.org/tickets/SPECPR-358" target="_blank" rel="noopener">SPECPR-358</a>).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">openEHR SEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">09 Nov 2020</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECQUERY-31" target="_blank" rel="noopener">SPECQUERY-31</a> Move AQL examples to a new separate specification.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">openEHR SEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">09 Nov 2020</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECQUERY-16" target="_blank" rel="noopener">SPECQUERY-16</a> Add support for <code>LIMIT</code> and <code>OFFSET</code>; deprecate <code>TOP</code> (<a href="https://specifications.openehr.org/tickets/SPECPR-346" target="_blank" rel="noopener">SPECPR-346</a>).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P Pazos,<br>
S Iancu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">05 Nov 2020</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Release 1.0.1</strong></p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECQUERY-20" target="_blank" rel="noopener">SPECQUERY-20</a> Clarify major keyword documentation and semantics; remove <code>TIMEWINDOW</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">openEHR SEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15 Jun 2020</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECQUERY-23" target="_blank" rel="noopener">SPECQUERY-23</a> Improve introductory text; update section 2.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15 Apr 2020</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECQUERY-19" target="_blank" rel="noopener">SPECQUERY-19</a> Clarify use of terminology 'identified path'.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P Pazos,<br>
 T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 Apr 2020</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECQUERY-14" target="_blank" rel="noopener">SPECQUERY-14</a>: Correct typographical errors (<a href="https://specifications.openehr.org/tickets/SPECPR-320" target="_blank" rel="noopener">SPECPR-320</a>, <a href="https://specifications.openehr.org/tickets/SPECPR-345" target="_blank" rel="noopener">SPECPR-345</a>, <a href="https://specifications.openehr.org/tickets/SPECPR-212" target="_blank" rel="noopener">SPECPR-212</a>, <a href="https://specifications.openehr.org/tickets/SPECPR-332" target="_blank" rel="noopener">SPECPR-332</a>, <a href="https://specifications.openehr.org/tickets/SPECPR-331" target="_blank" rel="noopener">SPECPR-331</a>);<br>
 <a href="https://specifications.openehr.org/tickets/SPECQUERY-15" target="_blank" rel="noopener">SPECQUERY-15</a>: Add clarifications and fix typographical errors (<a href="https://specifications.openehr.org/tickets/SPECPR-359" target="_blank" rel="noopener">SPECPR-359</a>);<br>
 <a href="https://specifications.openehr.org/tickets/SPECQUERY-4" target="_blank" rel="noopener">SPECQUERY-4</a>: Improve documentation of 'matches' operator;<br>
 <a href="https://specifications.openehr.org/tickets/SPECQUERY-2" target="_blank" rel="noopener">SPECQUERY-2</a>: Clarify the return structure of an AQL query (<a href="https://specifications.openehr.org/tickets/SPECPR-320" target="_blank" rel="noopener">SPECPR-320</a>).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P Pazos,<br>
 B Næss,<br>
 S Arikan,<br>
 S Iancu,<br>
 M Polajnar,<br>
 I McNicoll,<br>
 T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 Apr 2020</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Release 1.0.0</strong></p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECQUERY-6" target="_blank" rel="noopener">SPECQUERY-6</a> Publish original AQL wiki page as formal specification;<br>
 Various reformatting, adjustment of headings;<br>
 Fix missing square brackets on query example. (<a href="https://specifications.openehr.org/tickets/SPECPR-236" target="_blank" rel="noopener">SPECPR-236</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">openEHR SEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 Jan 2017</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add Antlr grammar for AQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B Lah</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13 Jan 2012</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial Writing, based on <a href="https://specifications.openehr.org/wiki/display/spec/Archetype+Query+Language+Description">openEHR AQL wiki page</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C Ma<br>
 H Frankel<br>
 T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 Dec 2008</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements"><a class="anchor" href="#_acknowledgements"></a>Acknowledgements</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_primary_author"><a class="anchor" href="#_primary_author"></a>Primary Author</h3>
<div class="ulist">
<ul>
<li>
<p>Chunlan Ma, MD, Ocean Informatics, Australia.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_contributors"><a class="anchor" href="#_contributors"></a>Contributors</h3>
<div class="paragraph">
<p>This specification benefited from wide formal and informal input from the openEHR and wider health informatics community. The openEHR Foundation would like to recognise the following people for their contributions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Birger Haarbrandt, MSc, Peter L. Reichertz Institut for Medical Informatics (PLRI), Germany</p>
</li>
<li>
<p>Bjørn Næss, DIPS, Norway</p>
</li>
<li>
<p>Borut Fabjan, Program Manager, Better, Slovenia</p>
</li>
<li>
<p>Bostjan Lah, Senior Architect, Better, Slovenia</p>
</li>
<li>
<p>Heath Frankel, Ocean Informatics, Australia</p>
</li>
<li>
<p>Ian McNicoll MD, FreshEHR, UK</p>
</li>
<li>
<p>Luiz Marco-Ruiz, PhD, Norwegian Centre for E-health Research, Norway</p>
</li>
<li>
<p>Matija Polajnar, PhD, Software Engineer, Better, Slovenia</p>
</li>
<li>
<p>Pablo Pazos Gutierrez, Senior engineer, CaboLabs, Uruguay</p>
</li>
<li>
<p>Sebastian Iancu, Architect, Code24, Netherlands</p>
</li>
<li>
<p>Seref Arikan, MEcon, Ocean Informatics UK, Centre for Health Informatics and Multi-professional Education (CHIME) UK</p>
</li>
<li>
<p>Thomas Beale, Ars Semantica UK, openEHR Foundation Management Board</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_support"><a class="anchor" href="#_support"></a>Support</h3>
<div class="paragraph">
<p>The work reported in this paper has been funded by the following organisations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ocean Informatics, Australia</p>
</li>
<li>
<p>Better d.o.o., Slovenia (was Marand)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_trademarks"><a class="anchor" href="#_trademarks"></a>Trademarks</h3>
<div class="ulist">
<ul>
<li>
<p>'openEHR' is a trademark of the openEHR Foundation</p>
</li>
<li>
<p>'Java' is a registered trademark of Oracle Corporation</p>
</li>
<li>
<p>'Microsoft' and '.Net' are trademarks of the Microsoft Corporation</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preface"><a class="anchor" href="#_preface"></a>1. Preface</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_purpose"><a class="anchor" href="#_purpose"></a>1.1. Purpose</h3>
<div class="paragraph">
<p>This document describes the syntax of the openEHR Archetype Query Language (AQL).</p>
</div>
</div>
<div class="sect2">
<h3 id="_status"><a class="anchor" href="#_status"></a>1.2. Status</h3>
<div class="paragraph">
<p>This specification is in the STABLE state. The latest development version of this document can be found at <a href="https://specifications.openehr.org/releases/QUERY/latest/AQL.html" target="_blank" rel="noopener">https://specifications.openehr.org/releases/QUERY/latest/AQL.html</a>.</p>
</div>
<div class="paragraph">
<p>Known omissions or questions are indicated in the text with a 'to be determined' paragraph, as follows:</p>
</div>
<div class="paragraph tbd">
<p><strong>TBD</strong>: (example To Be Determined paragraph)</p>
</div>
</div>
<div class="sect2">
<h3 id="_tools"><a class="anchor" href="#_tools"></a>1.3. Tools</h3>
<div class="paragraph">
<p>Various tools that can be used to work with archetypes and templates, including extracting 'archetype paths' for use in AQL statements, are listed on the openEHR website <a href="https://www.openehr.org/downloads/modellingtools" target="_blank" rel="noopener">modelling tools page</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_feedback"><a class="anchor" href="#_feedback"></a>1.4. Feedback</h3>
<div class="paragraph">
<p>Feedback may be provided on the <a href="https://discourse.openehr.org/c/specifications/aql" target="_blank" rel="noopener">openEHR AQL forum</a>.</p>
</div>
<div class="paragraph">
<p>Issues may be raised on the <a href="https://specifications.openehr.org/components/QUERY/open_issues" target="_blank" rel="noopener">specifications Problem Report tracker</a>.</p>
</div>
<div class="paragraph">
<p>To see changes made due to previously reported issues, see the <a href="https://specifications.openehr.org/components/QUERY/history" target="_blank" rel="noopener">QUERY component Change Request tracker</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_original_source"><a class="anchor" href="#_original_source"></a>1.5. Original Source</h3>
<div class="paragraph">
<p>The text of this specification was originally posted on the <a href="https://specifications.openehr.org/wiki/spaces/spec/pages/4915203/AQL-+Archetype+Query+Language" target="_blank" rel="noopener">openEHR wiki</a>, and was used by the global openEHR community in that form.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>2. Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_existing_query_languages"><a class="anchor" href="#_existing_query_languages"></a>2.1. Existing Query Languages</h3>
<div class="paragraph">
<p>Currently mainstream database query languages such as <a href="https://en.wikipedia.org/wiki/SQL" target="_blank" rel="noopener">Structured Query Language (SQL)</a>, <a href="https://www.w3.org/XML/Query/" target="_blank" rel="noopener">W3C XQuery</a>, and <a href="https://en.wikipedia.org/wiki/Object_Query_Language" target="_blank" rel="noopener">Object Query Language (OQL)</a> have dependencies on particular data schemas and physical representations (e.g. relational tables). Users must know the physical data schema of a particular database in order to write a valid query. A query statement written for one schema will not usually work in other systems, which have generally have different data schemas, even for storing the same data. One reason schemas are different between systems relates to differing optimisation requirements and choices. Queries written in these languages therefore are not usually <em>portable across systems</em>.</p>
</div>
<div class="paragraph">
<p>More modern web-oriented languages such as <a href="https://www.w3.org/TR/sparql11-query/" target="_blank" rel="noopener">W3C Sparql</a> and <a href="http://graphql.org">GraphQL</a> are not database- or system-oriented as such, and do not suffer from the problem of portability. However, both the database- and web-oriented languages suffer from another problem, which is being limited to a single level of semantic representation, i.e. they effectively assume an Entity-Attribute-Value (EAV) data meta-model. This prevents their direct use with multi-level models, such as those based on <a href="https://specifications.openehr.org/releases/AM/latest/index" target="_blank" rel="noopener">openEHR Archetype model</a>, or its ISO equivalent <a href="https://www.iso.org/standard/62305.html" target="_blank" rel="noopener">ISO 13606-2:2019</a>.</p>
</div>
<div class="paragraph">
<p>In order to overcome these limitations, this specification describes a query language designed to support <em>portable queries based on multi-level models</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_is_aql"><a class="anchor" href="#_what_is_aql"></a>2.2. What is AQL?</h3>
<div class="paragraph">
<p>Archetype Query Language (AQL) is a declarative query language developed specifically for expressing queries used for searching and retrieving the data found in archetype-based repositories. The examples used in this specification mostly relate to the <a href="https://specifications.openehr.org/releases/RM/latest/index" target="_blank" rel="noopener">openEHR Reference Model</a> (RM) and the <a href="https://www.openehr.org/ckm" target="_blank" rel="noopener">openEHR clinical archetypes</a>, but the syntax is independent of information model, application, programming language, system environment, and storage model.</p>
</div>
<div class="paragraph">
<p>The minimum requirement for data to be queried using AQL (including with archetype structures and terminology) is that it be based on <a href="https://specifications.openehr.org/releases/AM/latest/index" target="_blank" rel="noopener">archetypes</a>, which concretely means that it contains fine-grained semantic markings in the form of archetype and terminology codes. This may be native openEHR RM data, or legacy system data to which the relevant semantic markers (i.e. archetype and terminology codes) have been added. Consequently, AQL expresses queries in terms of a combination of archetype semantic elements and RM data structure elements on which the archetypes are based, rather than solely the latter, which is the case for EAV-based query languages such as SQL. This is the key in developing and sharing semantic queries across system and enterprise boundaries.</p>
</div>
<div class="paragraph">
<p>AQL has the following distinctive features:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the utilization of <a href="#_openehr_path_syntax">openEHR path syntax</a> to locate clinical statements and data values within them using archetypes; this syntax is used to represent the query criteria and returned results, and allows stating query criteria using archetype and node identifiers, data values within the archetypes, and class attributes defined within the Reference Model;</p>
</li>
<li>
<p>returned results may be objects of any granularity from 'top-level' RM objects to primitive data items;</p>
</li>
<li>
<p>the utilization of a <a href="#_containment"><code>CONTAINS</code> operator</a> to match data hierarchy relationships in order to constrain the source data to which the query is applied;</p>
</li>
<li>
<p>the utilization of ADL-like operator syntaxes, such as <code>matches</code>, <code>exists</code>, <code>in</code>, and <code>not</code>;</p>
</li>
<li>
<p>model-neutral syntax: AQL does not have any dependency on a Reference Model; it is also neutral to system implementation and environment;</p>
</li>
<li>
<p>supports time-based conditions to query historical versions of data.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>AQL also has features found in other query languages, including:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>naming returned results;</p>
</li>
<li>
<p>query criteria parameters;</p>
</li>
<li>
<p>arithmetic, comparison and logical operators;</p>
</li>
<li>
<p>functions;</p>
</li>
<li>
<p>preferences on the result retrieval and structuring, such as ordering and total number of retrieved results.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_aql_example"><a class="anchor" href="#_aql_example"></a>2.3. AQL example</h3>
<div class="paragraph">
<p>Below is an example of an AQL statement. This statement returns all blood pressure values contained in <code>COMPOSITION</code> instances defined by the <code>openEHR-EHR-COMPOSITION.encounter.v1</code> archetype, which contain <code>OBSERVATION</code> instances defined by the <code>openEHR-EHR-OBSERVATION.blood_pressure.v1</code> archetype, where the systolic value is greater than or equal to 140 or whose diastolic value is greater than or equal to 90, within a specified EHR (i.e. whose EHR id is the value of the variable <code>$ehrUid</code>). The AQL syntax is a synthesis of SQL structural syntax and the <a href="#_openehr_path_syntax">openEHR path syntax</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT                                                       -- Select clause
   o/data[at0001]/.../items[at0004]/value AS systolic,       -- Identified path with alias
   o/data[at0001]/.../items[at0005]/value AS diastolic,
FROM                                                         -- From clause
   EHR[ehr_id/value=$ehrUid]                                 -- RM class expression
      CONTAINS                                               -- containment
         COMPOSITION c                                       -- RM class expression
            [openEHR-EHR-COMPOSITION.encounter.v1]           -- archetype predicate
         CONTAINS
            OBSERVATION o [openEHR-EHR-OBSERVATION.blood_pressure.v1]
WHERE                                                        -- Where clause
   o/data[at0001]/.../items[at0004]/value/value &gt;= 140 OR    -- value comparison
   o/data[at0001]/.../items[at0005]/value/value &gt;= 90</pre>
</div>
</div>
<div class="paragraph">
<p>More examples can be found in the <a href="https://specifications.openehr.org/releases/QUERY/latest/AQL_examples.html" target="_blank" rel="noopener">openEHR AQL examples</a> document.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aql_syntax_description"><a class="anchor" href="#_aql_syntax_description"></a>3. AQL Syntax Description</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_2"><a class="anchor" href="#_overview_2"></a>3.1. Overview</h3>
<div class="paragraph">
<p>AQL has the following clauses:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>SELECT</code> clause specifies the data elements to be returned.</p>
</li>
<li>
<p>The <code>FROM</code> clause specifies the result source and the corresponding containment criteria.</p>
</li>
<li>
<p>The <code>WHERE</code> clause specifies data value criteria within the result source.</p>
</li>
<li>
<p>The <code>ORDER BY</code> clause indicates the data items used to order the returned result set.</p>
</li>
<li>
<p>The <code>LIMIT</code> clause indicates which portion of the result set will be returned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In AQL, <a href="#_openehr_path_syntax">openEHR path syntax</a> is used to locate any node or data values defined within archetypes. In the <code>SELECT</code> clause, the openEHR path syntax can be used to indicate expected objects or data values to be returned (similarly to how SQL 'projections' work). The <code>FROM</code> clause uses <a href="#_containment">containment</a> mechanisms indicating the scope of the query data source. <code>WHERE</code> clause uses archetype path to set query criteria on archetypes or any node within the archetypes. The following sections introduce the AQL syntax in detail.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reserved_words_and_characters"><a class="anchor" href="#_reserved_words_and_characters"></a>3.2. Reserved words and characters</h3>
<div class="paragraph">
<p>Keywords in AQL are not case sensitive, so <code>SELECT</code>, <code>Select</code>, <code>select</code>, <code>SeLeCt</code>, etc. are processed in the same way. AQL has the following reserved keywords and characters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SELECT</code>, <code>AS</code>, <code>FROM</code>, <code>CONTAINS</code>, <code>WHERE</code></p>
</li>
<li>
<p><code>ORDER BY</code>, <code>LIMIT</code>, <code>OFFSET</code></p>
</li>
<li>
<p><code>DISTINCT</code></p>
</li>
<li>
<p>operators: <code>AND</code>, <code>OR</code>, <code>NOT</code>, <code>LIKE</code>, <code>matches</code>, <code>exists</code>, <code>&lt;</code>, <code>&gt;</code>, <code>=</code>, <code>!</code></p>
</li>
<li>
<p>functions: <code>count</code>, <code>min</code>, <code>max</code>, <code>sum</code>, <code>avg</code>, <code>length</code>, <code>contains</code>, <code>position</code>, <code>substring</code>, <code>concat</code>, <code>concat_ws</code>, <code>abs</code>, <code>mod</code>, <code>ceil</code>, <code>floor</code>, <code>round</code>, <code>current_date</code>, <code>current_time</code>, <code>current_date_time</code>, <code>now</code>, <code>current_timezone</code>, <code>terminology</code></p>
</li>
<li>
<p>constants: <code>true</code>, <code>false</code></p>
</li>
<li>
<p><code>"</code> and <code>'</code>: double and single quote characters are used to delimit string values</p>
</li>
<li>
<p><code>|</code>: bar characters are used to delimit intervals</p>
</li>
<li>
<p><code>[]</code>: brackets are used to delimit coded terms or predicate expressions</p>
</li>
<li>
<p><code>{}</code>: curly braces are used with <code>matches</code> delimiting matches criteria</p>
</li>
<li>
<p><code>()</code>: parentheses are used with function calls or to separate logic or group expressions and enforce precedence</p>
</li>
<li>
<p><code>$</code>: dollar sign used to prefix parameters</p>
</li>
<li>
<p><code>:</code>, <code>?</code>, <code>&amp;</code>, <code>%</code>, <code>#</code>, <code>@</code>, <code>*</code>: characters that mainly used as part of a terminology or openEHR URI</p>
</li>
<li>
<p><code>/</code>, <code>.</code>: used by openEHR path syntax</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>TOP</code> modifier is deprecated in favour of the <code>LIMIT</code> clause combined with <code>ORDER BY</code> (see <a href="#_limit">below</a>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_openehr_path_syntax"><a class="anchor" href="#_openehr_path_syntax"></a>3.3. openEHR path syntax</h3>
<div class="paragraph">
<p>The openEHR path syntax has been described in detail (see <a href="https://specifications.openehr.org/releases/BASE/latest/architecture_overview.html#_paths_and_locators" target="_blank" rel="noopener">Paths and Locators</a> section in the <a href="https://specifications.openehr.org/releases/BASE/latest/architecture_overview.html" target="_blank" rel="noopener">Architecture Overview specification</a>). AQL utilises the openEHR path syntax to reference both coarse-grained and fine-grained archetype nodes (objects and data values, respectively), and openEHR class instances and attributes, when referencing something that is not defined in an archetype but is part of the openEHR Reference Model.</p>
</div>
<div class="paragraph">
<p>There are two types of openEHR paths used in AQL queries: an <em>archetype path</em>, referring to a node within an archetype, and a <em>RM class attribute path</em>, pointing to an attribute of an openEHR Reference Model class. These paths uses also <em>predicate expressions</em> (see <a href="#_predicates">Section 3.6</a>) enclosed by brackets (<code>[]</code>), to define criteria for coarse-grained and fine-grained data.</p>
</div>
<div class="paragraph">
<p>A set of openEHR path examples are shown below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Examples of archetype path syntax</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Archetype RM type</th>
<th class="tableblock halign-left valign-top">Archetype node name</th>
<th class="tableblock halign-left valign-top">Archetype ID</th>
<th class="tableblock halign-left valign-top">Path syntax</th>
<th class="tableblock halign-left valign-top">Referenced RM Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OBSERVATION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apgar score</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">openEHR-EHR-OBSERVATION.apgar.v1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OBSERVATION</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OBSERVATION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Heart rate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">openEHR-EHR-OBSERVATION.pulse.v1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/data[at0002]/events[at0003]/data[at0001]/items[at0004]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ELEMENT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OBSERVATION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Systolic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">openEHR-EHR-OBSERVATION.blood_pressure.v2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DV_QUANTITY</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Examples of RM class attribute path syntax using attributes from the <code>COMPOSITION</code> class</caption>
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">openEHR RM attribute name</th>
<th class="tableblock halign-left valign-top">Path syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COMPOSITION.category</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/category</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COMPOSITION.context.start_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/context/start_time</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COMPOSITION.uid.value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/uid/value</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_variables"><a class="anchor" href="#_variables"></a>3.4. Variables</h3>
<div class="paragraph">
<p>AQL variables are used to refer a specific openEHR class defined within an AQL <code>FROM</code> clause. Consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
   o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude,
   o/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude
FROM
   EHR [ehr_id/value='1234']
      CONTAINS COMPOSITION [openEHR-EHR-COMPOSITION.encounter.v1]
         CONTAINS OBSERVATION o [openEHR-EHR-OBSERVATION.blood_pressure.v1]
WHERE
   o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude &gt;= 140 OR
   o/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude &gt;= 90</pre>
</div>
</div>
<div class="paragraph">
<p>This example defines only one AQL variable: <code>o</code>, which represents <code>OBSERVATIONs</code> that conform to (i.e. created using) the <code>openEHR-EHR-OBSERVATION.blood_pressure.v1</code> archetype. This combination of a variable reference and a class represents a <em>class expression</em> (see <a href="#_class_expressions">Section 3.10.1</a>).</p>
</div>
<div class="paragraph">
<p>The combination of a variable reference and a subordinate <a href="#_openehr_path_syntax">path</a> forms one kind of <em>identified path</em> (see <a href="#_identified_paths">Section 3.7</a>), used to specify a fine-grained data element within a larger object matched by the <code>FROM</code> clause.</p>
</div>
<div class="sect3">
<h4 id="_variable_syntax"><a class="anchor" href="#_variable_syntax"></a>3.4.1. Syntax</h4>
<div class="paragraph">
<p>AQL variables have the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AQL variables are defined in the AQL <code>FROM</code> clause.</p>
</li>
<li>
<p>A variable name must be unique within an AQL statement.</p>
</li>
<li>
<p>Not all classes defined within the <code>FROM</code> clause need a variable name. It is required only when other AQL clauses need to refer to the class identified in the <code>FROM</code> clause. The example above doesn&#8217;t define a variable name for the <code>EHR</code> or <code>COMPOSITION</code> classes, only for the <code>OBSERVATION</code> class (variable <code>o</code>), to allow the latter to be referred to in the <code>WHERE</code> and <code>SELECT</code> clauses, as the root object of specific paths.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A variable name is formed of an initial letter followed by any number of alphanumerics and underscores, as long as it does not clash with an <a href="#_reserved_words_and_characters">AQL reserved word</a>. Variable names are not case-sensitive. Digits are not recommended at the beginning of a variable name although there is no formal restriction.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parameters"><a class="anchor" href="#_parameters"></a>3.5. Parameters</h3>
<div class="paragraph">
<p>AQL syntax supports parameterisation. AQL parameters are used to indicate criteria, which will be substituted with values at run time. Supporting parameterisation is one of the mechanisms used to realise sharing AQL statements within a system or across system boundaries.</p>
</div>
<div class="paragraph">
<p>The parameters can be class specific (such as the parameter of EHR identifier or EHR creation date/time), archetype specific (such as an archetype identifier, or archetype constraints), or template specific (such as a template identifier or template constraints).</p>
</div>
<div class="sect3">
<h4 id="parameter_syntax"><a class="anchor" href="#parameter_syntax"></a>3.5.1. Syntax</h4>
<div class="paragraph">
<p>A parameter always starts with a dollar sign <code>$</code> followed by the parameter name, e.g. <code>$ehrUid</code>. The parameter name can consist of letters, digits and underscores. It cannot have spaces, and it cannot be an <a href="#_reserved_words_and_characters">AQL reserved word</a>.</p>
</div>
<div class="paragraph">
<p>A parameter can be used for any criteria values within an AQL statement, e.g.:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>within a predicate: <code>[$archetypeId]</code>, <code>[at0003, $nameValue]</code>, <code>[ehr_id/value=$ehrUid]</code></p>
</li>
<li>
<p>withing a <code>WHERE</code> criteria: <code>o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/value &gt; $systolicCriteria</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In the <code>WHERE</code> criteria, when the value of the parameter is not a number or boolean value, it should be substituted with the corresponding quotes added to the value, for instance <code>o/../.. = $textVariable</code>, when substituted should look like this <code>o/../.. = "value"</code> (single or double quotes could be used). So substituted values follow the same rules as each type when the value is specified as a constant in the AQL expression: strings, dates, times and datetimes should be quoted, numbers and booleans are not quoted.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_parameters_use_case"><a class="anchor" href="#_parameters_use_case"></a>3.5.2. Parameters use case</h4>
<div class="paragraph">
<p>Parameters are needed when the same AQL query statement is used with different criteria values. This AQL example is to return all abnormal blood pressure values for a single specific EHR, indicated by <code>$ehrUid</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
   o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude,
   o/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude
FROM
   EHR [ehr_id/value=$ehrUid]
      CONTAINS COMPOSITION [openEHR-EHR-COMPOSITION.encounter.v1]
         CONTAINS OBSERVATION o [openEHR-EHR-OBSERVATION.blood_pressure.v1]
WHERE
   o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude &gt;= 140 OR
   o/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude &gt;= 90</pre>
</div>
</div>
<div class="paragraph">
<p>This parameter will be substituted by a specific <code>EHR.ehr_id</code> value at run time. Consequently, this query can be reused for all <code>EHRs</code> within a system.</p>
</div>
</div>
<div class="sect3">
<h4 id="_parameter_resolution"><a class="anchor" href="#_parameter_resolution"></a>3.5.3. Parameter Resolution</h4>
<div class="paragraph">
<p>AQL query parameters can be resolved at application level, or EHR system level. It depends on what the query parameters are used for and the design/implementation of the system or components. Query parameters would be normally resolved outside of a query engine.</p>
</div>
<div class="paragraph">
<p>If a query needs to be reusable across different EHR systems, any query parameters normally need to be registered in these EHR systems so that they can be resolved with real values from each environment. A typical example of this type of query parameter is <code>$ehrUid</code>. If the query is only used within an application, then the query parameters would be resolved by the application, such as the parameter of healthcare facility identifier or template identifier.</p>
</div>
<div class="paragraph">
<p>There are no specific guidelines on how to resolve query parameters. Generally speaking, a parameter name is used as a key (or a key is associated with a parameter name), and the key needs to be unique within the boundary where the parameters are resolved. The EHR system or application needs to have the API functions to get the real value with a given parameter name or key.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_predicates"><a class="anchor" href="#_predicates"></a>3.6. Predicates</h3>
<div class="paragraph">
<p>AQL uses predicates (see <a href="https://specifications.openehr.org/releases/BASE/latest/architecture_overview.html#_predicate_expressions" target="_blank" rel="noopener">Predicate Expressions</a>) to define criteria for coarse-grained and fine-grained data. Predicate expressions are always enclosed by brackets (<code>[]</code>).</p>
</div>
<div class="paragraph">
<p>There are three types of predicates used by AQL: the <em>standard predicate</em>, the <em>archetype predicate</em>, and the <em>node predicate</em>.</p>
</div>
<div class="sect3">
<h4 id="_standard_predicate"><a class="anchor" href="#_standard_predicate"></a>3.6.1. Standard predicate</h4>
<div class="paragraph">
<p>Standard predicates always have a left-hand operand, an operator and a right-hand operand, e.g. <code>[ehr_id/value='123456']</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The left-hand operand is normally an openEHR path, such as <code>ehr_id/value</code>, <code>name/value</code>.</p>
</li>
<li>
<p>The right-hand operand is normally a criterion value or a parameter, such as <code>'123456'</code>, <code>$ehrUid</code>. It can also be another openEHR path.</p>
</li>
<li>
<p>The operator can be one of the following:</p>
<div class="listingblock">
<div class="content">
<pre>&gt;, &gt;=, =, &lt;, &lt;=, !=</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_archetype_predicate"><a class="anchor" href="#_archetype_predicate"></a>3.6.2. Archetype predicate</h4>
<div class="paragraph">
<p>An archetype predicate is a shortcut of a standard predicate, i.e. the predicate does not have the left-hand operand and operator. It only has an archetype id, e.g. <code>[openEHR-EHR-COMPOSITION.encounter.v1]</code>. The archetype predicate is a specific type of query criterion indicating which archetype instances are relevant to this query. It is used to scope the data source from which the query result data is to be retrieved. Therefore, an archetype predicate is only used within an AQL <code>FROM</code> clause, for example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FROM EHR [ehr_id/value='1234']
   CONTAINS COMPOSITION c [openEHR-EHR-COMPOSITION.encounter.v1]
      CONTAINS OBSERVATION o [openEHR-EHR-OBSERVATION.blood_pressure.v1]</pre>
</div>
</div>
<div class="paragraph">
<p>This predicates could also be written as standard predicates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FROM EHR e
   CONTAINS COMPOSITION c
      CONTAINS OBSERVATION o
WHERE
   e/ehr_id/value = '1234' AND
   c/archetype_node_id = 'openEHR-EHR-COMPOSITION.encounter.v1' AND
   o/archetype_node_id = 'openEHR-EHR-OBSERVATION.blood_pressure.v1'</pre>
</div>
</div>
<div class="paragraph">
<p>This equivalence could be used by implementers of AQL to transform predicates into their standard form, as a canonical representation of the query, which can simplified its processing, validation, evaluation and transformation into specific database query languages.</p>
</div>
</div>
<div class="sect3">
<h4 id="_node_predicate"><a class="anchor" href="#_node_predicate"></a>3.6.3. Node predicate</h4>
<div class="paragraph">
<p>A node predicate is also a shortcut of a standard predicate. It has the following forms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Containing an <code>archetype_node_id</code> (i.e. an at-code) only, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre>[at0002]</pre>
</div>
</div>
<div class="paragraph">
<p>The corresponding standard predicate would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[archetype_node_id=at0002]</pre>
</div>
</div>
</li>
<li>
<p>Containing an <code>archetype_node_id</code> and a <code>name/value</code> criterion, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre>[at0002 and name/value=$nameValue]
[at0002 and name/value='real name value']</pre>
</div>
</div>
<div class="paragraph">
<p>The corresponding standard predicates would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[archetype_node_id=at0002 and name/value=$nameValue]
[archetype_node_id=at0002 and name/value='real name value']</pre>
</div>
</div>
</li>
<li>
<p>Containing an <code>archetype_node_id</code> and a shortcut of a <code>name/value</code> criterion, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre>[at0002, $nameValue]
[at0002, 'real name value']</pre>
</div>
</div>
<div class="paragraph">
<p>The corresponding standard predicates would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[archetype_node_id=at0002 and name/value=$nameValue]
[archetype_node_id=at0002 and name/value='real name value']</pre>
</div>
</div>
</li>
<li>
<p>The above three forms are the most common node predicates. A more advanced form is to include a general criterion instead of the <code>name/value</code> criterion within the predicate. The general criterion consists of left-hand operand, operator, and right-hand operand, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre>[at0002 and value/defining_code/terminology_id/value=$terminologyId]</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>A node predicate defines criteria on fine-grained data.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_identified_paths"><a class="anchor" href="#_identified_paths"></a>3.7. Identified Paths</h3>
<div class="paragraph">
<p>In AQL, an <em>identified path</em> is the association of a <a href="#_variables">variable</a> reference (the identifier), a <a href="#_predicates">predicate</a> and/or an <a href="#_openehr_path_syntax">openEHR path</a>. Except for the <code>FROM</code> clause, an identified path may appear in any clause of an AQL statement. For example, it can be used to indicate the data to be returned in a <code>SELECT</code> clause, or the data item on which query criteria are applied in a <code>WHERE</code> clause.</p>
</div>
<div class="paragraph">
<p>In the following example, the identified path <code>o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude</code> specifies the systolic value of the Observation archetype <code>openEHR-EHR-OBSERVATION.blood_pressure.v1</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
   o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude
FROM
   EHR [ehr_id/value='1234']
      CONTAINS COMPOSITION [openEHR-EHR-COMPOSITION.encounter.v1]
         CONTAINS OBSERVATION o [openEHR-EHR-OBSERVATION.blood_pressure.v1]</pre>
</div>
</div>
<div class="sect3">
<h4 id="_identified_paths_syntax"><a class="anchor" href="#_identified_paths_syntax"></a>3.7.1. Syntax</h4>
<div class="paragraph">
<p>An AQL identified path can take any of the following forms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a variable name defined in the <code>FROM</code> clause followed by an openEHR path, which specifies a data item at that path within the object, as follows:</p>
<div class="listingblock">
<div class="content">
<pre>o/data[at0001]/.../data[at0003]/items[at0004]/value/value</pre>
</div>
</div>
</li>
<li>
<p>a variable name followed by a predicate, which specifies an object that satisfies the predicate, as follows:</p>
<div class="listingblock">
<div class="content">
<pre>o[name/value=$nameValue]</pre>
</div>
</div>
</li>
<li>
<p>a variable name followed by a predicate and an openEHR path, which specifies a data item at a path within an object satisfying the predicate, as follows:</p>
<div class="listingblock">
<div class="content">
<pre>o[name/value=$nameValue]/data[at0001]/.../data[at0003]/items[at0004]/value/value</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operators"><a class="anchor" href="#_operators"></a>3.8. Operators</h3>
<div class="paragraph">
<p>An AQL operator is a reserved word or a symbol, used primarily in <code>WHERE</code> clause to perform comparison or logical operation(s).</p>
</div>
<div class="sect3">
<h4 id="_comparison_operators"><a class="anchor" href="#_comparison_operators"></a>3.8.1. Comparison operators</h4>
<div class="paragraph">
<p>The table below shows the supported AQL comparison operators, meaning and example.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 62.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Meaning</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name/value = $nameValue</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>o/data[at0001]/&#8230;&#8203;/data[at0003]/items[at0004]/value/value &gt;140</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than or equal to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>o/data[at0001]/&#8230;&#8203;./data[at0003]/items[at0004]/value/value &gt;=140</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smaller than</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>o/data[at0001]/&#8230;&#8203;/data[at0003]/items[at0004]/value/value &lt;160</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smaller than or equal to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>o/data[at0001]/&#8230;&#8203;/data[at0003]/items[at0004]/value/value &#8656;160</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not equal to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c/archetype_details/template_id/value != ''</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LIKE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple pattern matching</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>o/data[at0001]/&#8230;&#8203;/name/value LIKE 'left *'</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advanced matcher</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>o/data[at0002]/&#8230;&#8203;/name/defining_code/code_string matches {'18919-1', '18961-3', '19000-9'}</code></p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_like"><a class="anchor" href="#_like"></a>3.8.1.1. LIKE</h5>
<div class="paragraph">
<p>The <code>LIKE</code> binary operator is used to compare a value of type string (or dates and times) against a simple pattern.
The left-hand operand is an AQL identified path to a data element that is either a String or has a String representation, while the right-hand operand is a String value, representing the pattern to be matched.
It returns <code>true</code> if the value matches the supplied pattern.</p>
</div>
<div class="paragraph">
<p>Below is an example using a simple pattern matching:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
   e/ehr_id/value, c/context/start_time
FROM
   EHR e
      CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.administrative_encounter.v1]
         CONTAINS ADMIN_ENTRY admission[openEHR-EHR-ADMIN_ENTRY.admission.v1]
WHERE
   c/context/start_time LIKE '2019-0?-*'</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>?</code> wildcard in pattern matches any single character, while the <code>*</code> wildcard matches any sequence of zero or more characters.
If the pattern does not contain any of these wildcards, then <code>LIKE</code> acts like the <code>=</code> (equal) operator.
The <code>LIKE</code> operator always tries to match the entire string value, therefore if the intention is to match a sequence anywhere within the string, the pattern must start and end with <code>*</code> wildcard, e.g. <code>"*test*"</code>.</p>
</div>
<div class="paragraph">
<p>To match a literal <code>?</code> or <code>*</code>, the respective character in pattern must be escaped by using the backslash <code>\</code> character, e.g. <code>"test \?"</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_matches"><a class="anchor" href="#_matches"></a>3.8.1.2. matches</h5>
<div class="paragraph">
<p>The <code>matches</code> binary operator is used in the <code>WHERE</code> clause. The left-hand operand is an AQL identified path. The right-hand operand is enclosed within curly braces (<code>{}</code>), and may take the following forms:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>cADL list constraint</strong>: a comma-separated value list, which is one of the cADL constraint forms used in the <a href="https://specifications.openehr.org/releases/AM/latest/index" target="_blank" rel="noopener">Archetype Definition Language (ADL)</a>. Below is an example using a string value list:</p>
<div class="listingblock">
<div class="content">
<pre>SELECT
   o/data[at0002]/events[at0003]/data/items[at0015]/items[at0018]/name
FROM
   EHR [uid=$ehrUid]
      CONTAINS Composition c
         CONTAINS Observation o[openEHR-EHR-OBSERVATION.microbiology.v1]
WHERE
   o/data[at0002]/events[at0003]/data/items[at0015]/items[at0018]/items[at0019]/items[at0021]/name/defining_code/code_string matches {'18919-1', '18961-3', '19000-9'}</pre>
</div>
</div>
<div class="paragraph">
<p>Value list items may be of type string, date/time, integer, or real. Quotes are required for strings and date/times.</p>
</div>
<div class="paragraph">
<p>A value list is only used in AQL <code>WHERE</code> clause when the criteria is to match one item of the list. The relationships among these value list items are "OR".</p>
</div>
<div class="paragraph">
<p>Some examples of value list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>matches {'string item 1', 'string item 2', 'string item3'}  // A string list, equivalent to
                                                            // matches 'string item 1' or ..
                                                            // matches 'string item 2' or ..
                                                            // matches 'string item3'
matches {'2006-01-01', '2007-01-01', '2008-01-01'}          // a date value list
matches {1, 2, 3}                                           // an integer list
matches {1.1, 2.5, 3.8}                                     // a real value list</pre>
</div>
</div>
</li>
<li>
<p><strong>URI</strong>: this can be a terminology URI, an openEHR EHR URI, or other URI. An example with a terminology URI is shown below:</p>
<div class="listingblock">
<div class="content">
<pre>SELECT
   e/ehr_status/subject/external_ref/id/value, diagnosis/data/items[at0002.1]/value
FROM
   EHR e
      CONTAINS Composition c[openEHR-EHR-COMPOSITION.problem_list.v1]
         CONTAINS Evaluation diagnosis[openEHR-EHR-EVALUATION.problem-diagnosis.v1]
WHERE
   c/name/value='Current Problems' AND
   diagnosis/data/items[at0002.1]/value/defining_code matches { terminology://snomed-ct/hierarchy?rootConceptId=50043002 }</pre>
</div>
</div>
<div class="paragraph">
<p>URI data is enclosed within curly braces after <code>matches</code> operator. A URI is expressed in <a href="https://tools.ietf.org/html/rfc3986">IETF RFC 3986</a> format. URIs are not case sensitive.</p>
</div>
<div class="paragraph">
<p>A terminology URI consists of the following components:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><em>terminology</em>: the URI schemes value;</p>
</li>
<li>
<p><em>terminology service</em>: the URI authority value, such as SNOMED-CT;</p>
</li>
<li>
<p><em>terminology function name</em>: the URI path, e.g. "hierarchy" is the function name in the example shown below;</p>
</li>
<li>
<p><em>argument values</em> required by the terminology functions - URI queries;</p>
<div class="paragraph">
<p>This is an example of a terminology URI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    terminology://snomed-CT/hierarchy?rootConceptId=50043002
    \_________/   \_______/ \_______/ \___________/ \______/
        |             |         |           |__________|
     scheme       authority   path          | queries  |
        |             |         |           |          |
    terminology  terminology function    argument   argument
       uri         service                 name      value</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><strong>results of function calls</strong>: a <code>TERMINOLOGY()</code> function (see <a href="#_terminology">below</a>) is used to invoke operations of an external terminology server and return the results back to the <code>matches</code> operator for further use. An example is shown below:</p>
<div class="listingblock">
<div class="content">
<pre>SELECT
   c/context/start_time, p/data/items[at0002]/value
FROM
   EHR e[ehr_id/value='1234']
      CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.problem_list.v1]
         CONTAINS EVALUATION p[openEHR-EHR-EVALUATION.problem-diagnosis.v1]
WHERE
   c/name/value='Current Problems' AND
   p/data/items[at0002]/value/defining_code/code_string matches TERMINOLOGY('expand', 'http://hl7.org/fhir/4.0', 'http://snomed.info/sct?fhir_vs=isa/50697003')</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_logical_operators"><a class="anchor" href="#_logical_operators"></a>3.8.2. Logical operators</h4>
<div class="sect4">
<h5 id="_and"><a class="anchor" href="#_and"></a>3.8.2.1. AND</h5>
<div class="paragraph">
<p><code>AND</code> is a binary operator used to combine two Boolean expressions. It represents a <em>logical 'and'</em> (conjunction) and evaluates to <code>true</code> when both operands evaluate to <code>true</code>, and it evaluates to <code>false</code> otherwise.</p>
</div>
</div>
<div class="sect4">
<h5 id="_or"><a class="anchor" href="#_or"></a>3.8.2.2. OR</h5>
<div class="paragraph">
<p><code>OR</code> is a binary operator used to combine two Boolean expressions. It represents a <em>logical 'or'</em> (disjunction) and evaluates to <code>true</code> when any of the operands evaluate to <code>true</code>, and it evaluates to <code>false</code> otherwise.</p>
</div>
</div>
<div class="sect4">
<h5 id="_not"><a class="anchor" href="#_not"></a>3.8.2.3. NOT</h5>
<div class="paragraph">
<p><code>NOT</code> is a unary operator used to negate a Boolean expression operand. It represents a <em>logical 'not'</em> (negation) and returns a Boolean result: <code>true</code> means the operand is <code>false</code>.</p>
</div>
<div class="paragraph">
<p>When used in the <code>WHERE</code> clause, a <code>NOT</code> expression is a kind of <a href="#_identified_expression">identified expression</a>. The example below uses <code>NOT</code> operator followed by a Boolean identified expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
   e/ehr_id/value
FROM
   EHR e
      CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.administrative_encounter.v1]
         CONTAINS ADMIN_ENTRY admission[openEHR-EHR-ADMIN_ENTRY.admission.v1]
WHERE
   NOT (EXISTS c/content[openEHR-EHR-ADMIN_ENTRY.discharge.v1] AND
   e/ehr_status/subject/external_ref/namespace = 'CEC')</pre>
</div>
</div>
<div class="paragraph">
<p>The above example is equivalent to the two expressions shown in the following <code>WHERE</code> clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
   e/ehr_id/value
FROM
   EHR e
      CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.administrative_encounter.v1]
         CONTAINS ADMIN_ENTRY admission[openEHR-EHR-ADMIN_ENTRY.admission.v1]
WHERE
   NOT EXISTS c/content[openEHR-EHR-ADMIN_ENTRY.discharge.v1] OR
   e/ehr_status/subject/external_ref/namespace != 'CEC'</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>NOT</code> operand in combination with <code>CONTAINS</code> can be used also in the <code>FROM</code> clause to express an exclusion constraint, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
   e/ehr_id/value
FROM
   EHR e
      CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.administrative_encounter.v1]
         NOT CONTAINS ADMIN_ENTRY admission[openEHR-EHR-ADMIN_ENTRY.admission.v1]
WHERE
   e/ehr_status/subject/external_ref/namespace != 'CEC'</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_exists"><a class="anchor" href="#_exists"></a>3.8.2.4. EXISTS</h5>
<div class="paragraph">
<p><code>EXISTS</code> is a unary operator, whose operand is an <a href="#_identified_paths">identified path</a>. It returns a Boolean result: <code>true</code> means the data associated with the specified path exists, <code>false</code> otherwise. An <code>EXISTS</code> expression is a kind of <a href="#_identified_expression">identified expression</a> that can be used only in <code>WHERE</code> clause.</p>
</div>
<div class="paragraph">
<p>In the AQL example below, <code>EXISTS</code> is used in negated form to filter out <code>COMPOSITIONs</code> (and therefore EHRs) that do not contain a discharge <code>ADMIN_ENTRY</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
   e/ehr_id/value
FROM
   EHR e
      CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.administrative_encounter.v1]
         CONTAINS ADMIN_ENTRY admission[openEHR-EHR-ADMIN_ENTRY.admission.v1]
WHERE
   NOT EXISTS c/content[openEHR-EHR-ADMIN_ENTRY.discharge.v1]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_functions"><a class="anchor" href="#_functions"></a>3.9. Functions</h3>
<div class="paragraph">
<p>AQL provides <em>built-in functions</em> to perform operations on data. Functions are similar to operators as they manipulate data and return a single result, but the difference is in the format and number of their arguments.</p>
</div>
<div class="paragraph">
<p>In general, a function syntax is <code>function(argument, argument, &#8230;&#8203;)</code>, accepting zero, one or more <em>arguments</em>, consisting of <a href="#_constants">constants</a>, <a href="#_parameters">parameters</a>, <a href="#_variables">variables</a>, <a href="#_identified_paths">identified paths</a> or other functions.
Functions are used primarily in the <code>SELECT</code> and <code>WHERE</code> clauses.</p>
</div>
<div class="paragraph">
<p>There are two types of functions: <em>single-row</em> functions, returning a single result for every row of the result set, and <em>aggregate</em> functions, returning a single result based on a group of rows of the result set rather than on a single row.</p>
</div>
<div class="paragraph">
<p>Most of AQL built-in functions are mapped to function definitions in the <a href="https://specifications.openehr.org/releases/BASE/latest/foundation_types.html" target="_blank" rel="noopener">openEHR Foundation Types</a> and in the <a href="https://specifications.openehr.org/releases/BASE/latest/base_types.html" target="_blank" rel="noopener">openEHR Base Types</a>, while others are borrowed from SQL languages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The followings are a set of core built-in functions defined by AQL specifications. Various other functions may exist however in various AQL implementations.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_aggregate_functions"><a class="anchor" href="#_aggregate_functions"></a>3.9.1. Aggregate functions</h4>
<div class="paragraph">
<p>Aggregate functions calculate a single result value from a set of <em>input values</em>, allowing the query to return summarized information about a data item or a result set.
Input values are selected by an <em>expression</em> in a form of an <a href="#_identified_paths">identified path</a> applied to data items filtered by <code>FROM</code> and <code>WHERE</code> clauses.
Unless specified otherwise, these functions ignore <code>NULL</code> values.</p>
</div>
<div class="paragraph">
<p>The table below shows the supported AQL aggregate functions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">COUNT()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the count of the number of rows returned or of the input values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MIN()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the minimum of the non-null input values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAX()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the maximum of the non-null input values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SUM()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the sum of the non-null input values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AVG()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the average (arithmetic mean) of all the non-null input values</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The example below uses <code>MIN()</code>, <code>MAX()</code> and <code>AVG()</code> functions to determine edge and mean values for systolic blood pressure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
    MAX(o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude) AS maxValue,
    MIN(o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude) AS minValue,
    AVG(o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude) AS meanValue
FROM
    EHR e CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.encounter.v1]
        CONTAINS OBSERVATION o[openEHR-EHR-OBSERVATION.blood_pressure.v1]</pre>
</div>
</div>
<div class="sect4">
<h5 id="_count"><a class="anchor" href="#_count"></a>3.9.1.1. COUNT</h5>
<div class="paragraph">
<p>The <code>COUNT</code> function returns the number of values of given <em>expression</em> argument. The syntax is <code>COUNT([DISTINCT] expression|*)</code>.</p>
</div>
<div class="paragraph">
<p>The <code>COUNT(*)</code> is used to calculate the number of rows of the result set, whether or not they contain <code>NULL</code>.
The <code>DISTINCT</code> keyword can be used to calculate the number of only distinct values of <em>expression</em>.</p>
</div>
<div class="paragraph">
<p>If there are no matching rows, then this function returns <code>0</code>.
Input values type can be anything, while the return type is always an Integer.</p>
</div>
</div>
<div class="sect4">
<h5 id="_min"><a class="anchor" href="#_min"></a>3.9.1.2. MIN</h5>
<div class="paragraph">
<p>The <code>MIN</code> function returns the minimum value of given <em>expression</em> argument. The syntax is <code>MIN(expression)</code>.</p>
</div>
<div class="paragraph">
<p>If there are no matching rows, then this function returns <code>NULL</code>.
Input values type should be either String, Date, Time, Integer of Real, and it will also determine the return type.</p>
</div>
</div>
<div class="sect4">
<h5 id="_max"><a class="anchor" href="#_max"></a>3.9.1.3. MAX</h5>
<div class="paragraph">
<p>The <code>MAX</code> function returns the maximum value of given <em>expression</em> argument. The syntax is <code>MAX(expression)</code>.</p>
</div>
<div class="paragraph">
<p>If there are no matching rows, then this function returns <code>NULL</code>.
Input values type should be either String, Date, Time, Integer of Real, and it will also determine the return type.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sum"><a class="anchor" href="#_sum"></a>3.9.1.4. SUM</h5>
<div class="paragraph">
<p>The <code>SUM</code> function returns the sum value of given <em>expression</em> argument. The syntax is <code>SUM(expression)</code>.</p>
</div>
<div class="paragraph">
<p>If there are no matching rows, then this function returns <code>NULL</code>.
Input values type should be either Integer of Real, and it will also determine the return type.</p>
</div>
</div>
<div class="sect4">
<h5 id="_avg"><a class="anchor" href="#_avg"></a>3.9.1.5. AVG</h5>
<div class="paragraph">
<p>The <code>AVG</code> function returns the average value of given <em>expression</em> argument. The syntax is <code>AVG(expression)</code>.</p>
</div>
<div class="paragraph">
<p>If there are no matching rows, then this function returns <code>NULL</code>.
Input values type should be either Integer of Real, and it will also determine the return type.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_string_functions"><a class="anchor" href="#_string_functions"></a>3.9.2. String functions</h4>
<div class="paragraph">
<p>AQL provides single-row functions for examining and manipulating string values.</p>
</div>
<div class="paragraph">
<p>The table below shows the built-in AQL string functions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENGTH()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the length of a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONTAINS()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validates if a string contains other string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POSITION()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the position of the first occurrence of substring in a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SUBSTRING()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extracts the substring as specified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONCAT()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the string that results from concatenating the arguments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONCAT_WS()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the string that results from concatenating the arguments with separator</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For functions that operate on string positions, the first position is numbered 1.
For functions that take length arguments, non-integer arguments are rounded to the nearest integer.</p>
</div>
<div class="sect4">
<h5 id="_length"><a class="anchor" href="#_length"></a>3.9.2.1. LENGTH</h5>
<div class="paragraph">
<p>The <code>LENGTH</code> function returns the number of characters of a given <em>expression</em> argument.
The syntax is <code>LENGTH(expression)</code>, where the argument is of type String. The result type is Integer.</p>
</div>
</div>
<div class="sect4">
<h5 id="_contains"><a class="anchor" href="#_contains"></a>3.9.2.2. CONTAINS</h5>
<div class="paragraph">
<p>The <code>CONTAINS</code> function with syntax is <code>CONTAINS(string, substring)</code> returns the <code>true</code> if the <code>string</code> argument expression contains the <code>substring</code>.
The arguments are of type String, while the result type is Boolean.</p>
</div>
</div>
<div class="sect4">
<h5 id="_position"><a class="anchor" href="#_position"></a>3.9.2.3. POSITION</h5>
<div class="paragraph">
<p>The <code>POSITION</code> function with syntax is <code>POSITION(substring, string)</code> returns the position (index) of the first occurrence of <code>substring</code> in <code>string</code> argument expression, or zero if it&#8217;s not present.
The arguments are of type String, while the result type is Integer.</p>
</div>
</div>
<div class="sect4">
<h5 id="_substring"><a class="anchor" href="#_substring"></a>3.9.2.4. SUBSTRING</h5>
<div class="paragraph">
<p>The <code>SUBSTRING</code> function with syntax is <code>SUBSTRING(string, position, length)</code> extracts the substring of <code>string</code>, starting at the <code>position</code>-th character, and stopping after <code>length</code> characters, if that is specified.
The first argument is of type String, while <code>position</code>, <code>length</code> are Integers. The result type is String.</p>
</div>
<div class="paragraph">
<p>The <code>length</code> argument is optional, and when not provided this function will extract the substring from the <code>position</code> until the end of the given <code>string</code> argument.</p>
</div>
</div>
<div class="sect4">
<h5 id="_concat"><a class="anchor" href="#_concat"></a>3.9.2.5. CONCAT</h5>
<div class="paragraph">
<p>The <code>CONCAT</code> function with syntax is <code>CONCAT(string1, string2, &#8230;&#8203;)</code> returns the string that results from concatenating all the arguments. It may have one or more expression arguments, all of type String.</p>
</div>
</div>
<div class="sect4">
<h5 id="_concat_ws"><a class="anchor" href="#_concat_ws"></a>3.9.2.6. CONCAT_WS</h5>
<div class="paragraph">
<p>The <code>CONCAT_WS</code> function with syntax is <code>CONCAT_WS(separator, string1, string2, &#8230;&#8203;)</code> returns the string that results from concatenating all the arguments with <code>separator</code> string, i.e. the separator is added between the strings to be concatenated.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_numeric_functions"><a class="anchor" href="#_numeric_functions"></a>3.9.3. Numeric functions</h4>
<div class="paragraph">
<p>Numeric single-row functions are providing various mathematical functions for numeric type arguments.</p>
</div>
<div class="paragraph">
<p>The table below shows the built-in AQL numeric functions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ABS()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the absolute value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MOD()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the remainder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CEIL()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the nearest integer greater than or equal to argument</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLOOR()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the nearest integer less than or equal to argument</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROUND()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rounds the argument</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_abs"><a class="anchor" href="#_abs"></a>3.9.3.1. ABS</h5>
<div class="paragraph">
<p>The <code>ABS</code> function returns the absolute value of given <em>expression</em> argument.
The syntax is <code>ABS(expression)</code>, where the argument is of type Real or Integer. The result type is derived from the argument type.</p>
</div>
</div>
<div class="sect4">
<h5 id="_mod"><a class="anchor" href="#_mod"></a>3.9.3.2. MOD</h5>
<div class="paragraph">
<p>The <code>MOD</code> function with the syntax <code>MOD(x, y)</code> returns the remainder of <code>x</code> divided by <code>y</code>.
The arguments <code>x</code> and <code>y</code> are of type Real or Integer, while the result is derived from the arguments type.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ceil"><a class="anchor" href="#_ceil"></a>3.9.3.3. CEIL</h5>
<div class="paragraph">
<p>The <code>CEIL</code> function returns the Integer greater than or equal to <em>expression</em> argument.
The syntax is <code>CEIL(expression)</code>, where the argument is of type Real or Integer.</p>
</div>
</div>
<div class="sect4">
<h5 id="_floor"><a class="anchor" href="#_floor"></a>3.9.3.4. FLOOR</h5>
<div class="paragraph">
<p>The <code>FLOOR</code> function returns the Integer less than or equal to <em>expression</em> argument.
The syntax is <code>FLOOR(expression)</code>, where the argument is of type Real or Integer.</p>
</div>
</div>
<div class="sect4">
<h5 id="_round"><a class="anchor" href="#_round"></a>3.9.3.5. ROUND</h5>
<div class="paragraph">
<p>The <code>ROUND</code> function with the syntax <code>ROUND(expression, d)</code> returns the rounded <em>expression</em> argument <code>expression</code> to <code>d</code> decimal places.
The argument <code>expression</code> is of type Real or Integer, and the result of the function is derived from it.
The argument <code>d</code> is of type Integer, and defaults to value <code>0</code> if not specified.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_date_and_time_functions"><a class="anchor" href="#_date_and_time_functions"></a>3.9.4. Date and time functions</h4>
<div class="paragraph">
<p>AQL provides single-row functions for examining and manipulating date, time or datetime values.</p>
</div>
<div class="paragraph">
<p>The table below shows the built-in AQL date and time functions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CURRENT_DATE()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the current date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CURRENT_TIME()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the current time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CURRENT_DATE_TIME()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the current datetime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOW()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An alias for CURRENT_DATE_TIME()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CURRENT_TIMEZONE()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the current timezone</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_current_date"><a class="anchor" href="#_current_date"></a>3.9.4.1. CURRENT_DATE</h5>
<div class="paragraph">
<p>The function with syntax <code>CURRENT_DATE()</code> accepts no arguments and returns the current date as string value with the format 'YYYY-MM-DD'.</p>
</div>
</div>
<div class="sect4">
<h5 id="_current_time"><a class="anchor" href="#_current_time"></a>3.9.4.2. CURRENT_TIME</h5>
<div class="paragraph">
<p>The function with syntax <code>CURRENT_TIME()</code> accepts no arguments and returns the current time as string value with the format 'hh:mm:ss'.</p>
</div>
</div>
<div class="sect4">
<h5 id="_current_date_time_or_now"><a class="anchor" href="#_current_date_time_or_now"></a>3.9.4.3. CURRENT_DATE_TIME or NOW</h5>
<div class="paragraph">
<p>The function with syntax <code>CURRENT_DATE_TIME()</code>, or <code>NOW()</code>, accepts no arguments and returns the current datetime as string value with the format 'YYYY-MM-DDThh:mm:ss.sss±hh:mm'.</p>
</div>
</div>
<div class="sect4">
<h5 id="_current_timezone"><a class="anchor" href="#_current_timezone"></a>3.9.4.4. CURRENT_TIMEZONE</h5>
<div class="paragraph">
<p>The function with syntax <code>CURRENT_TIMEZONE()</code> accepts no arguments and returns the current timezone as string value with the format '±hh:mm'.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_other_functions"><a class="anchor" href="#_other_functions"></a>3.9.5. Other functions</h4>
<div class="sect4">
<h5 id="_terminology"><a class="anchor" href="#_terminology"></a>3.9.5.1. TERMINOLOGY</h5>
<div class="paragraph">
<p>Often the <code>matches</code> operator may be need to perform a request to a terminology server, in order to execute some <em>operations</em> over a value set or code system (a synonym of <em>terminology</em>).
Several operations may be possible: the expansion of a ValueSet (or Reference Set), checking that a concept belongs to a value set or code system, testing if one concept subsumes another one, or the mapping of concepts across different terminologies.
While matching value by a pure terminology concept specified as <a href="#_matches_terminology_uri">a terminology URI</a> is possible, the invocation of external terminology servers from AQL requires a special function, to perform all these operations.</p>
</div>
<div class="paragraph">
<p>The <code>TERMINOLOGY</code> function is used to invoke operations of an external terminology server and return the results for further processing by AQL.
The syntax is <code>TERMINOLOGY(operation, service_api, params_uri)</code>, having all arguments of type String, while the return type depends on the invoked <code>operation</code> and <code>service_api</code> and is considered to be of <code>Any</code> type.</p>
</div>
<div class="paragraph">
<p>The <code>operation</code> argument specifies the action to perform over the specified value set or code system. It is not restricted to any particular value as different terminology servers may use different ways of specifying the operation and its parameters. The specified operation can be properly dereferenced by the implementation of the <code>service_api</code>.
Some examples of typical operations are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>expand</strong>: Expand a value set; this will retrieve all the codes contained in a value set as an explicit set.</p>
</li>
<li>
<p><strong>validate</strong>: Validate a code in a value set; this will check if a given code belongs to a value set. Recall that the value set may comprise all the codes in a code system (terminology).</p>
</li>
<li>
<p><strong>lookup</strong>: Look-up a code; this will retrieve all the information concerning one particular code. Examples are retrieving the preferred form to display, synonyms, etc.</p>
</li>
<li>
<p><strong>map</strong>: Map a code (translate between value sets); this will convert (find an equivalent code) from one Value Set to another one based on a predefined mapping available in the external terminology service. Translation precision may not be limited to full equivalence and different kinds of mappings may be possible (wider meaning, equivalent, narrower meaning, etc).</p>
</li>
<li>
<p><strong>subsumes</strong>: Subsumption testing; this will determine if a particular terminology concept is a subtype (is-a) of another one. For example, test in SNOMED-CT if <code>"Myasthenia Gravis | 91637004"</code> is a subtype of <code>"autoimmune disease | 85828009"</code> (i.e. test if <code>85828009</code> subsumes <code>91637004</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>service_api</code> argument represents an identifier of a type of terminology service. This is not the service endpoint as such, neither a service name, but an identifier for the kind/flavour of terminology syntax that is being sent. It provides the information to send requests related to the ValueSet, <code>operation</code> and parameters to the right terminology service. In addition, it is closely related to the strategy to parse the terminology service response in a format acceptable by the query processor.
Some examples of typical values for <code>service_api</code> are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service_api</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://hl7.org/fhir/4.0" class="bare">http://hl7.org/fhir/4.0</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FHIR Terminology Service v4.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://hl7.org/fhir/3.0" class="bare">http://hl7.org/fhir/3.0</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FHIR Terminology Service v3.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://hl7.org/fhir/1.0" class="bare">http://hl7.org/fhir/1.0</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FHIR Terminology Service v1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ots.oceanhealthsystems.com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ocean Terminology Service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bts.better.care</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Better Terminology Service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apelon.dts.org/4.7.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apelon Terminology Service, version 4.7.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">example.terminology-service.api/v1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An example of a fictive terminology service</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>params_uri</code> argument consists of URI path and query sections in compliance with <a href="https://tools.ietf.org/html/rfc3986">IETF RFC 3986</a>. Most common operations use this to identify the value set on which to perform the <code>operation</code>. A value set may be a full code system such as the full set of codes in SNOMED-CT or LOINC. The value set URI may include the version and edition sections (e.g. Australian, US, etc). When the release and version identifiers are not provided, it is up to the external terminology server to decide which default version will be used.
Some examples of typical URI parameters are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">URI parameters</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://terminology.hl7.org/ValueSet/v3-FamilyMember" class="bare">http://terminology.hl7.org/ValueSet/v3-FamilyMember</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://vsac.nlm.nih.gov/valueset/2.16.840.1.113762.1.4.1010.2" class="bare">https://vsac.nlm.nih.gov/valueset/2.16.840.1.113762.1.4.1010.2</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://snomed.info/sct/32506021000036107/version/20200331?fhir_vs=refset/1200161000168100" class="bare">http://snomed.info/sct/32506021000036107/version/20200331?fhir_vs=refset/1200161000168100</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implicit VS defined for Australian Refset for Vaccination Reason</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://snomed.info/sct" class="bare">http://snomed.info/sct</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.omim.org" class="bare">http://www.omim.org</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://fhir.de/CodeSystem/dimdi/icd-10-gm" class="bare">http://fhir.de/CodeSystem/dimdi/icd-10-gm</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>TERMINOLOGY</code> function can be used in the following ways in the <code>WHERE</code> clause:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>as a right-hand operand of <code>matches</code> operator, to directly match function results, e.g.</p>
<div class="listingblock">
<div class="content">
<pre>WHERE e/value/defining_code/code_string matches TERMINOLOGY('expand', 'http://hl7.org/fhir/4.0', 'http://snomed.info/sct?fhir_vs=isa/50697003')</pre>
</div>
</div>
</li>
<li>
<p>embedded between curly braces (<code>{}</code>) of the right-hand operand of <code>matches</code>, for merging explicit codes with the function results (in which case the AQL interpreter is responsible for generating a valid list of codes during semantic analysis), e.g.</p>
<div class="listingblock">
<div class="content">
<pre>WHERE e/value/defining_code/code_string matches {'http://snomed.info/id/442031002', TERMINOLOGY('expand', 'http://hl7.org/fhir/4.0', 'http://snomed.info/sct?fhir_vs=isa/50697003')}</pre>
</div>
</div>
</li>
<li>
<p>as a Boolean value expression, when an assertion is being tested, e.g.</p>
<div class="listingblock">
<div class="content">
<pre>WHERE
    TERMINOLOGY('validate', 'http://hl7.org/fhir/r4', 'system=http://snomed.info/sct&amp;code=122298005&amp;url=http://snomed.info/sct?fhir_vs&amp;display=Astrovirus RNA assay') = true</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>More examples can be found in the <a href="https://specifications.openehr.org/releases/QUERY/latest/AQL_examples.html#_terminology" target="_blank" rel="noopener">openEHR AQL examples</a> document.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_expressions"><a class="anchor" href="#_expressions"></a>3.10. Expressions</h3>
<div class="paragraph">
<p>AQL expressions provide a formal way of evaluating, transforming or comparing values. An expression is a combination of one or more <a href="#_constants">constants</a>, <a href="#_operators">operators</a>, <a href="#_variables">variables</a>, <a href="#_predicates">predicates</a>, <a href="#_parameters">parameters</a> or <a href="#_functions">functions</a> that evaluates to a value.</p>
</div>
<div class="sect3">
<h4 id="_class_expressions"><a class="anchor" href="#_class_expressions"></a>3.10.1. Class expressions</h4>
<div class="paragraph">
<p><em>Class expressions</em> are used in the <code>FROM</code> clause for two purposes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>indicating the constraints on RM classes so as to scope the data source for the query. For instance, <code>EHR e[ehr_id/value='123456']</code> indicates that the required data must be from a specific <code>EHR</code> with <code>ehr_id</code> value <code>'123456'</code>; while <code>COMPOSITION c[openEHR-EHR-COMPOSITION.report.v1]</code> indicates the required data must be from or must be associated with a Composition instance with archetype id - <code>openEHR-EHR-COMPOSITION.report.v1</code>.</p>
</li>
<li>
<p>defining an RM class variable that may be used by other clauses to indicate the required data or data items on which query criteria are applied. The example below uses the class expression to define a variable <code>e</code> which is used by the <code>SELECT</code> clause indicating all relevant <code>ehr_id</code> values are retrieved, and a variable <code>c</code> used by the <code>WHERE</code> clause indicating that the query criteria is set on the Composition <code>template_id</code> value.</p>
<div class="listingblock">
<div class="content">
<pre>SELECT
   e/ehr_id/value
FROM
   EHR e
      CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.referral.v1]
WHERE
   c/archetype_details/template_id/value = $templateId</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Class expressions syntax include three parts. A class expression must have part one and at least one of part two or part three.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>part one (mandatory): RM class name, such as <code>EHR</code>, <code>COMPOSITION</code>, <code>OBSERVATION</code> etc.</p>
</li>
<li>
<p>part two (optional): AQL variable name</p>
</li>
<li>
<p>part three (optional): a standard predicate or an archetype predicate.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Two examples of a class expression are shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// EHR class, class identifier/variable, and a standard predicate
EHR e[ehr_id/value=$ehrUid]</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>// COMPOSITION class, class identifier/variable, and an archetype predicate
COMPOSITION c[openEHR-EHR-COMPOSITION.report.v1]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_identified_expression"><a class="anchor" href="#_identified_expression"></a>3.10.2. Identified expression</h4>
<div class="paragraph">
<p>An <em>identified expression</em> specifies matching criteria in the <code>WHERE</code> clause and comes in two forms.</p>
</div>
<div class="paragraph">
<p>The first form is an expression formed by a unary operator, such as <code>NOT</code> or <code>EXISTS</code>, described in <a href="#_logical_operators">Section 3.8.2</a>.</p>
</div>
<div class="paragraph">
<p>The second is a binary operator expression, formed as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>left operand</em>: an <a href="#_identified_paths">identified path</a> or a <a href="#_functions">function</a> having an identified path as an argument;</p>
</li>
<li>
<p><em>operator</em>: a <a href="#_comparison_operators">comparison operator</a>;</p>
</li>
<li>
<p><em>right operand</em>: one of:</p>
<div class="ulist">
<ul>
<li>
<p>a value criterion, normally of a <a href="#_constants">constant</a> or a <a href="#_functions">function</a>; OR</p>
</li>
<li>
<p>a replaceable <a href="#_parameters">parameter</a> (identified with the <code>'$'</code> symbol); OR</p>
</li>
<li>
<p>a pattern or condition, in case the operator <code>matches</code> or <code>LIKE</code> is used; OR</p>
</li>
<li>
<p>an identified path.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following examples illustrate the binary form.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Left-hand operand is an identified path; right-hand operand is a primitive value:</p>
<div class="listingblock">
<div class="content">
<pre>o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/value &gt;= 140

c/archetype_details/template_id/value = 'health_encounter'</pre>
</div>
</div>
</li>
<li>
<p>Left-hand operand is an identified path and right-hand operand is a parameter:</p>
<div class="listingblock">
<div class="content">
<pre>c/archetype_details/template_id/value = $templateParameter</pre>
</div>
</div>
</li>
<li>
<p>Left-hand operand is an identified path; right-hand operand is a pattern:</p>
<div class="listingblock">
<div class="content">
<pre>c/archetype_details/template_id/value LIKE '*encounter*'</pre>
</div>
</div>
</li>
<li>
<p>Both left-hand operand and right-hand operand are identified paths:</p>
<div class="listingblock">
<div class="content">
<pre>o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/value &gt;
o1/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/value</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_constants"><a class="anchor" href="#_constants"></a>3.11. Constants</h3>
<div class="paragraph">
<p>A <em>constant</em>, often referred as <em>literal value</em>, is a fixed value that is supplied directly in the AQL statement, not derived from an <a href="#_identified_paths">identified path</a>, a <a href="#_variables">variable</a>, or a <a href="#_name_alias">column alias name</a>. This value can be any of the AQL built-in types, where strings, dates, times and datetimes should be quoted, while numbers and booleans are not quoted.</p>
</div>
</div>
<div class="sect2">
<h3 id="_built_in_types"><a class="anchor" href="#_built_in_types"></a>3.12. Built-in Types</h3>
<div class="sect3">
<h4 id="_integer_data"><a class="anchor" href="#_integer_data"></a>3.12.1. Integer data</h4>
<div class="paragraph">
<p>Integers are represented as numeric literals, such as <code>1</code>, <code>2</code>, <code>365</code>. Commas or periods for breaking long numbers are not allowed. Hexadecimal representation is not supported.</p>
</div>
</div>
<div class="sect3">
<h4 id="_real_data"><a class="anchor" href="#_real_data"></a>3.12.2. Real data</h4>
<div class="paragraph">
<p>Real numbers are the decimal literals that include a decimal point, such as <code>3.1415926</code>. Commas or periods for breaking long numbers are not allowed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_boolean_data"><a class="anchor" href="#_boolean_data"></a>3.12.3. Boolean data</h4>
<div class="paragraph">
<p>Boolean values are indicated using the case-insensitive literals <code>true</code> or <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_string_data"><a class="anchor" href="#_string_data"></a>3.12.4. String data</h4>
<div class="paragraph">
<p>All strings are enclosed in double or single quotes. Line breaks are not supported.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dates_and_times"><a class="anchor" href="#_dates_and_times"></a>3.12.5. Dates and Times</h4>
<div class="paragraph">
<p>These types are treated as strings and should comply with the rules for string quoting. The format of the date, time and datetime types should comply with the <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601 Date and Time</a> format specification, which allow the basic or extended formats to be used. In the openEHR specification it is recommended to use the extended format for dates, times and datetimes. Complete or partial values are allowed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The underlying types of date/time strings are inferred by the AQL processor from the context (metadata associated with the path to which the date/time value is compared with, or by interpretation of the ISO 8601 format), enabling them to be processed as date/time quantities rather than literal strings by AQL engines.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Examples are as below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// complete datetime in ISO 8601 extended format: AQL grammar identifies this value as a datetime value.
WHERE composition/context/start_time &lt;= '1986-01-01T12:00:00.000+09:30'</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>// complete date in ISO 8601 extended format: AQL grammar identifies this value as a date value.
WHERE composition/context/start_time &lt;= '1986-01-01'</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>// a complete date in ISO 8601 basic format: AQL grammar identifies it as a string value.
WHERE composition/context/start_time &gt; '19860101'</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>// ISO 8601 time extended format: AQL grammar identifies it as a string value.
WHERE composition/context/start_time &lt; '12:00:00+09:30'</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_query_structure"><a class="anchor" href="#_query_structure"></a>3.13. Query structure</h3>
<div class="sect3">
<h4 id="_overview_3"><a class="anchor" href="#_overview_3"></a>3.13.1. Overview</h4>
<div class="paragraph">
<p>AQL structure was briefly introduced in <a href="#_aql_example">Section 2.3</a>. This section describes the syntax in more formal detail. An AQL query may include the following clauses which must occur in the order shown.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SELECT</code> (mandatory)</p>
</li>
<li>
<p><code>FROM</code> (mandatory)</p>
</li>
<li>
<p><code>WHERE</code> (optional)</p>
</li>
<li>
<p><code>ORDER BY</code> (optional)</p>
</li>
<li>
<p><code>LIMIT</code> (optional)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An AQL statement must at least contain the <code>SELECT</code> and <code>FROM</code> clauses.</p>
</div>
</div>
<div class="sect3">
<h4 id="_from"><a class="anchor" href="#_from"></a>3.13.2. FROM</h4>
<div class="paragraph">
<p>The <code>FROM</code> clause is used to specify the subset of all the data available in a repository,
that will be available for the rest of the clauses to filter and return specific data (<code>WHERE</code>, <code>SELECT</code>, etc).
The data available should be defined by an information model, known here as the <em>Reference Model (RM)</em>, that supports the use of archetype- and template-based constraint models, as described in the <a href="https://specifications.openehr.org/releases/BASE/latest/architecture_overview.html" target="_blank" rel="noopener">openEHR Architecture Overview</a> and the <a href="https://specifications.openehr.org/releases/AM/latest/Overview.html" target="_blank" rel="noopener">Archetype Technology Overview</a>.</p>
</div>
<div class="paragraph">
<p>All the classes referenced by the <code>FROM</code> clause should be defined by the RM. For instance,
if the Reference Model is the <a href="https://specifications.openehr.org/releases/RM/latest/index" target="_blank" rel="noopener">openEHR Reference Model</a>, the <code>FROM</code> clause should only include classes like
<code>EHR</code>, <code>COMPOSITION</code>, <code>OBSERVATION</code>, <code>EVALUATION</code>, and so on.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The AQL specification is not bound to a specific Reference Model, but to use a
given RM, it should comply with some requirements: it should be an Object Oriented
Model and should follow the dual-model approach.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, the expressions in the <code>WHERE</code> clause will filter data, but only from the subset
defined by the <code>FROM</code> clause. And in the <code>SELECT</code> clause, a final projection is applied,
selecting only the matched data that should be retrieved in the query result. In addition
to the filtering done in the <code>WHERE</code> clause, the <a href="#_class_expressions">class expressions</a> could hold predicates
that also allow filtering data.</p>
</div>
<div class="paragraph">
<p>In summary:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>FROM</code>: Defines the subset of data over which the query will be executed;</p>
</li>
<li>
<p><code>WHERE</code>: Filters data from the defined subset, leaving only the data that we need;</p>
</li>
<li>
<p>predicates in <em>class expressions</em>: further filters for data in the subset;</p>
</li>
<li>
<p><code>SELECT</code>: picks the exact data that we need to return from the query, taken from the matched data in the previous two points.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_from_syntax"><a class="anchor" href="#_from_syntax"></a>3.13.2.1. Syntax</h5>
<div class="paragraph">
<p>A simple <code>FROM</code> clause consists of three parts: keyword <code>FROM</code>, <em>class expression</em> and/or <em>containment constraints</em>, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FROM
   EHR e [ehr_id/value=$ehrUid]
      CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.report.v1]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_containment"><a class="anchor" href="#_containment"></a>3.13.2.2. Containment</h5>
<div class="paragraph">
<p>Since archetypes are in hierarchical structure, AQL has a containment constraint which specifies the hierarchical relationships between parent and child data items. The <code>FROM</code> clause utilises this hierarchical constraint along with <a href="#_class_expressions">class expression</a> to determine the data source to which the AQL query is applied.</p>
</div>
<div class="paragraph">
<p>The syntax of containment constraint expression is very simple: using <code>CONTAINS</code> operator between two class expressions. Left-hand operand class expression is the parent object of the right-hand operand class expression, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>EHR e CONTAINS COMPOSITION c [openEHR-EHR-COMPOSITION.referral.v1]</pre>
</div>
</div>
<div class="paragraph">
<p>Logical operators <code>AND</code> and <code>OR</code> and parentheses <code>()</code> are used when multiple containment constrains are required, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>EHR e
   CONTAINS COMPOSITION c [openEHR-EHR-COMPOSITION.referral.v1] AND COMPOSITION c1 [openEHR-EHR-COMPOSITION.report.v1]</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>EHR e
   CONTAINS COMPOSITION c [openEHR-EHR-COMPOSITION.referral.v1]
      CONTAINS (OBSERVATION o [openEHR-EHR-OBSERVATION-laboratory-hba1c.v1] OR OBSERVATION o1 [openEHR-EHR-OBSERVATION-laboratory-glucose.v1])</pre>
</div>
</div>
<div class="paragraph">
<p>The logical operator <code>NOT</code> can be used in combination with <code>CONTAINS</code> to express an exclusion constraint,  i.e. the absence of any containment relationship between a parent and potential child items. The following example matches referral COMPOSITIONs that do not contain laboratory test result OBSERVATIONs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>EHR e
    CONTAINS COMPOSITION c [openEHR-EHR-COMPOSITION.referral.v1]
        NOT CONTAINS OBSERVATION o [openEHR-EHR-OBSERVATION-laboratory_test_result.v1]</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_where"><a class="anchor" href="#_where"></a>3.13.3. WHERE</h4>
<div class="paragraph">
<p>An AQL <code>WHERE</code> clause is used to represent further criteria applied to the data items within the objects declared in the <code>FROM</code> clause. A <code>WHERE</code> clause expresses the query criteria that cannot be represented in other AQL clauses, such as criteria on archetype id, composition committal date/time, and the criteria on in which order the returned results should be listed.</p>
</div>
<div class="sect4">
<h5 id="_where_syntax"><a class="anchor" href="#_where_syntax"></a>3.13.3.1. Syntax</h5>
<div class="paragraph">
<p>The <code>WHERE</code> clause syntax has the following parts (in order): keyword <code>WHERE</code> and one or more <a href="#_identified_expression">identified expressions</a>. Logical operators <code>AND</code>, <code>OR</code>, <code>NOT</code> and parenthesis <code>()</code> can be used to combine multiple identified expressions. Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>WHERE
   c/name/value=$nameValue AND c/archetype_details/template_id/value=$templateId</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>WHERE
   (c/name/value = $nameValue OR c/archetype_details/template_id/value = $templateId) AND
   o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/value &gt;= 140</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_select"><a class="anchor" href="#_select"></a>3.13.4. SELECT</h4>
<div class="paragraph">
<p>A <code>SELECT</code> clause specifies what data is to be retrieved by the AQL query. The data can be any types from RM or any built-in data types (see <a href="#_built_in_types">Section 3.12</a>).</p>
</div>
<div class="sect4">
<h5 id="_select_syntax"><a class="anchor" href="#_select_syntax"></a>3.13.4.1. Syntax</h5>
<div class="paragraph">
<p>The syntax always starts with the keyword <code>SELECT</code>, optionally followed by <code>TOP</code> (deprecated - see <a href="#_top">below</a>), followed by one or more <em>column expressions</em>.</p>
</div>
<div class="paragraph">
<p>A column expression is formed by an <a href="#_identified_paths">identified path</a>, a <a href="#_functions">function</a>, a <a href="#_constants">constant</a> value or plain <a href="#_variables">variable</a> name defined in the <code>FROM</code> clause.
Where a variable name is specified, the full object of the type associated with the variable is retrieved, such as a <code>COMPOSITION</code>, <code>OBSERVATION</code> etc.
Where a function is specified, the call has to be done using the specified arguments and the results are returned.
Where an identified path is specified, the data item(s) having that archetype path are returned.</p>
</div>
<div class="paragraph">
<p>Each column expression may have a <a href="#_name_alias">name alias</a> renaming the associated data.
When the <code>SELECT</code> clause contains multiple column expressions, they are separated using a comma.</p>
</div>
<div class="paragraph">
<p>Some examples are shown below.</p>
</div>
<div class="listingblock">
<div class="title">Example 1: Retrieve all Compositions' name value, context start time and composer name from a specific EHR.</div>
<div class="content">
<pre>SELECT
   c/name/value AS Name, c/context/start_time AS date_time, c/composer/name AS Composer
FROM
   EHR e[ehr_id/value=$ehrUid]
       CONTAINS COMPOSITION c</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example 2: Retrieve all Composition objects of a specific EHR.</div>
<div class="content">
<pre>SELECT c
FROM EHR e[ehr_id/value=$ehrUid]
    CONTAINS COMPOSITION c</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example 3: Use of constants and function as column expressions.</div>
<div class="content">
<pre>SELECT
    true AS dangerousBP, "alert" as indication, count(*) as counter
FROM
    EHR [ehr_id/value=$ehrUid]
        CONTAINS COMPOSITION [openEHR-EHR-COMPOSITION.encounter.v1]
            CONTAINS OBSERVATION obs [openEHR-EHR-OBSERVATION.blood_pressure.v1]
WHERE
    obs/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude&gt;= 160 OR
    obs/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude&gt;= 110</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_top"><a class="anchor" href="#_top"></a>3.13.4.2. TOP</h5>
<div class="paragraph deprecated">
<p><strong>Deprecated</strong>: Starting with Release 1.1.0, the use of <code>TOP</code> modifier is deprecated in favour of the <code>LIMIT</code> clause combined with <code>ORDER BY</code> (see <a href="#_limit">below</a>).
The <code>TOP</code> will be removed in a future major release of AQL specification.
It is not allowed to use <code>TOP</code> while also using <code>LIMIT</code> clause in the same query.</p>
</div>
<div class="paragraph">
<p>The <code>TOP</code> syntax was borrowed from SQL language for representing the number of result sets that should be returned by the AQL query. It uses <code>BACKWARD</code> and <code>FORWARD</code> to indicate the direction where to start to get the number of results to be returned.</p>
</div>
<div class="paragraph">
<p>It starts with keyword <code>TOP</code>, followed by an integer number and/or the direction (i.e. <code>BACKWARD</code>, <code>FORWARD</code>), e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
   TOP 10 c/name/value AS Name, c/context/start_time AS date_time, c/composer/name AS Composer
FROM
   EHR e[ehr_id/value=$ehrUid]
      CONTAINS COMPOSITION c</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_name_alias"><a class="anchor" href="#_name_alias"></a>3.13.4.3. Name alias</h5>
<div class="paragraph">
<p>As in SQL, <code>AQL</code> supports the use of a name alias for the retrieved data. This is done with the keyword <code>AS</code>, followed by the name which conforms to the syntax rule of AQL variable.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_order_by"><a class="anchor" href="#_order_by"></a>3.13.5. ORDER BY</h4>
<div class="paragraph">
<p>The <code>ORDER BY</code> clause is used to sort the returned results.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If no <code>ORDER BY</code> clause is specified, then the query result doesn&#8217;t have any default ordering criteria defined by this specification. Ordering could be defined by each implementation or be random. In terms of compliance to this specification, default ordering in results is undefined.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_order_by_syntax"><a class="anchor" href="#_order_by_syntax"></a>3.13.5.1. Syntax</h5>
<div class="paragraph">
<p>The syntax starts with keyword <code>ORDER BY</code> followed by one or more <em>sorting expressions</em>.
A sorting expression consists of an identified path, optionally followed by one of the <code>DESC</code>, <code>DESCENDING</code>, <code>ASC</code>, or <code>ASCENDING</code> keyword, indicating the sorting type (descending or ascending), e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ORDER BY c/name/value DESC</pre>
</div>
</div>
<div class="paragraph">
<p>Sorting rows assumes that data identified by path (from the sorting expression) are comparable. It implies the use of a specific operators like <em>equal</em>, <em>less-than</em> and <em>greater-than</em> (all available to primitives and <code>Ordered</code> types) on data identified by path.</p>
</div>
<div class="paragraph">
<p>When sorting type is not specified, <code>ASC</code> (ascending) is assumed by default.</p>
</div>
<div class="paragraph">
<p>Multiple sorting expressions are separated using a comma. If two rows are equal according to the leftmost expression, they are compared according to the next sorting expression.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_limit"><a class="anchor" href="#_limit"></a>3.13.6. LIMIT</h4>
<div class="paragraph">
<p>The <code>LIMIT</code> clause is used to constrain the result set generated by the rest of the query.
It is often used together with an <code>OFFSET</code> subclause.</p>
</div>
<div class="paragraph">
<p>The <code>OFFSET</code> specifies the number of rows to skip before it starts to return rows from the query.
The <code>LIMIT</code> specifies the number of rows to return after the <code>OFFSET</code> clause has been processed.
Note that when using <code>LIMIT</code>, deterministic behavior requires that the <code>ORDER BY</code> clause is also used to constrain the result in a unique order.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
As of Release 1.1.0, the use of the <code>LIMIT</code> clause in combination with the <code>ORDER BY</code> clause is recommended instead of the deprecated <code>TOP</code> alternative.
It is not allowed to use <code>LIMIT</code> while also using <code>TOP</code> clause in the same query.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_limit_syntax"><a class="anchor" href="#_limit_syntax"></a>3.13.6.1. Syntax</h5>
<div class="paragraph">
<p>The syntax was borrowed from SQL language, similar to PostgreSQL and MySQL implementation.
It consists of two parts: keyword <code>LIMIT</code> followed by number, optionally followed by <code>OFFSET</code> followed by a number:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>LIMIT row_count [OFFSET offset]</pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>row_count</code> and <code>offset</code> are integer numbers, <code>row_count</code> minimal value is 1, while minimal value for <code>offset</code> is 0.</p>
</div>
<div class="paragraph">
<p>If a <code>LIMIT row_count</code> is given, no more than that many rows will be returned (but possibly fewer, if the query itself yields fewer rows).
The <code>OFFSET offset</code> is optional, and when not specified then <code>offset</code> = 0 is assumed.</p>
</div>
<div class="paragraph">
<p>The <code>LIMIT row_count OFFSET offset</code> is used to get results in a paginated way. For instance,
when <code>offset</code> = 0 and <code>row_count</code> = 10, the result will have at most 10 items, starting with item 0. Then with <code>offset</code> = 10 and
<code>row_count</code> = 10, the result will contain 10 items at most, now from item 10 to 19. So increasing <code>offset</code> by <code>row_count</code>,
allows to get all the results in a paginated way.</p>
</div>
<div class="paragraph">
<p>The following example will return 10 rows, representing the 2nd page of result set, ordered by event start time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
   c/name/value AS Name, c/context/start_time AS date_time, c/composer/name AS Composer
FROM
   EHR e[ehr_id/value=$ehrUid]
      CONTAINS COMPOSITION c
ORDER BY c/context/start_time
LIMIT 10 OFFSET 10</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_result_structure"><a class="anchor" href="#_result_structure"></a>4. Result structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The result structure of an AQL query in its raw form is a 2-dimensional table, conceptually similar to the tabular projection generated by a SQL query. Formally, it may be thought of as having the type <code>Array&lt;Array&lt;Any&gt;&gt;</code>, where <code>Any</code> is understood as the superclass of all object types, including primitive and constructed types.</p>
</div>
<div class="paragraph">
<p>In practical use, AQL queries will normally be executed through a library or service API, which is likely to provide an 'annotated' result structure, i.e. a data structure that includes meta-data such as column descriptors, thus enabling efficient result processing. Such annotated results are not formally defined by this specification, and are considered an artefact of the relevant API or service definition.</p>
</div>
<div class="paragraph">
<p>An example of such an extended structure is the 'Result set' used in openEHR, described by the <a href="https://specifications.openehr.org/releases/SM/latest/openehr_platform.html#_query_package" target="_blank" rel="noopener">openEHR Abstract Platform Query Service</a>. A concrete expression for use with the <a href="https://specifications.openehr.org/releases/ITS-REST/latest/query.html" target="_blank" rel="noopener">openEHR REST Query API</a> includes this structure, mapped to HTTP and JSON structures.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_write_an_aql_query_statement_manually"><a class="anchor" href="#_how_to_write_an_aql_query_statement_manually"></a>5. Writing AQL manually</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes how to write an AQL query statement manually.
An example is used to illustrate how to write an AQL statement. The query scenario is:</p>
</div>
<div class="paragraph">
<p><strong>"Get all abnormal blood pressure values that are recorded in a health encounter for a specific patient."</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
More examples can be found in the <a href="https://specifications.openehr.org/releases/QUERY/latest/AQL_examples.html" target="_blank" rel="noopener">openEHR AQL examples</a> document.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The process described here may provide some hints for constructing AQL builder tools.</p>
</div>
<div class="sect2">
<h3 id="_step_1_the_from_clause"><a class="anchor" href="#_step_1_the_from_clause"></a>5.1. Step 1. The FROM clause</h3>
<div class="paragraph">
<p>A <code>FROM</code> clause is to scope the data source for the query. Normally the first step is to determine the <code>FROM</code> clause, which has EHR class expression and archetype class expressions.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>EHR class expression</strong></p>
<div class="paragraph">
<p>This determines whether this query is applied to a single EHR or all EHRs. The latter is called a population query. If it is for all EHRs, there is no need to specify <code>ehr_id/value</code> in the <code>FROM</code> clause. Otherwise, you need to either specify a specific value or use a query parameter for <code>ehr_id/value</code> in a <code>FROM</code> clause. For this particular scenario, it is for a single EHR. A parameter called <code>ehrUid</code> is used for the <code>ehr_id/value</code>, giving this AQL query statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FROM EHR [ehr_id/value=$ehrUid]</pre>
</div>
</div>
</li>
<li>
<p><strong>Archetype expressions</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To write archetype expressions in the <code>FROM</code> clause, the archetypes required for the scenario must be determined, since archetypes are used to represent clinical concepts. The easy way to identify archetypes for a scenario is to identify clinical concepts mentioned in the scenario. Each clinical concept is generally associated with one archetype. Two clinical concepts are mentioned in the above scenario: 'blood pressure' and 'health encounter'. From these concepts the two archetypes used in query are identified: an Observation archetype <code>openEHR-EHR-OBSERVATION.blood_pressure.v1</code>, and a Composition archetype <code>openEHR-EHR-COMPOSITION.encounter.v1</code>.</p>
</li>
<li>
<p>Determine whether a variable name is needed for each archetype class expression or not. This is useful if the reference to the archetype class expression is required by other AQL clauses. Without using variable names for the archetype expressions, the two archetype expressions are:</p>
<div class="listingblock">
<div class="content">
<pre>COMPOSITION [openEHR-EHR-COMPOSITION.encounter.v1]
OBSERVATION [openEHR-EHR-OBSERVATION.blood_pressure.v1]</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Containment expression</strong></p>
<div class="paragraph">
<p>The openEHR RM is used to identify the hierarchical relationships among the found archetypes so as to define the containment expression. For example, a Composition archetype is the parent of an Observation archetype, so the AQL query looks as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FROM EHR [ehr_id/value=$ehrUid] CONTAINS COMPOSITION [openEHR-EHR-COMPOSITION.encounter.v1]
    CONTAINS OBSERVATION [openEHR-EHR-OBSERVATION.blood_pressure.v1]</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_the_where_clause"><a class="anchor" href="#_step_2_the_where_clause"></a>5.2. Step 2. The WHERE clause</h3>
<div class="paragraph">
<p>The <code>WHERE</code> clause represents all query criteria that cannot be represented in the <code>FROM</code> clause. To write a <code>WHERE</code> clause expression, the following is needed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Determine the criteria. The criteria required by the scenario are abnormal blood pressure values. Different guidelines may have different definitions for abnormal blood pressure values. Here <code>abnormal blood pressure</code> is interpreted to mean 1) the 'systolic pressure' value is greater than or equal to <code>140</code>; OR 2) the 'diastolic pressure' value is greater than or equal to <code>90</code>.</p>
</li>
<li>
<p>State an identified expression for criterion 1), as follows:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>state the identified path for the systolic data value. A class variable name is needed as the reference to the blood pressure class expression defined in the <code>FROM</code> clause, so a variable name <code>obs</code> is added into the <code>FROM</code> clause. A path to systolic data value is also required to form the identified path. The path to the systolic data value is <code>/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/value</code>.</p>
</li>
<li>
<p>choose the appropriate operator: <code>&gt;=</code> is used for criterion 1.</p>
</li>
<li>
<p>add the criteria value, here, <code>140</code>. The query statement including the identified expression for criterion 1) is shown below:</p>
<div class="listingblock">
<div class="content">
<pre>FROM
   EHR [ehr_id/value=$ehrUid] CONTAINS COMPOSITION [openEHR-EHR-COMPOSITION.encounter.v1]
       CONTAINS OBSERVATION obs [openEHR-EHR-OBSERVATION.blood_pressure.v1]
WHERE
   obs/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/value &gt;= 140</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Write an identified expression for criterion 2). Following the previous instruction to write the identified expression for criterion 2) which is shown as:</p>
<div class="listingblock">
<div class="content">
<pre>obs/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/value &gt;= 90</pre>
</div>
</div>
</li>
<li>
<p>Find the appropriate boolean operator to join criterion 1) and 2) - OR. The query statement looks like:</p>
<div class="listingblock">
<div class="content">
<pre>FROM
   EHR [ehr_id/value=$ehrUid] CONTAINS COMPOSITION [openEHR-EHR-COMPOSITION.encounter.v1]
      CONTAINS OBSERVATION obs [openEHR-EHR-OBSERVATION.blood_pressure.v1]
WHERE
   obs/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/value &gt;= 140 OR
   obs/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/value &gt;= 90</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_the_select_clause"><a class="anchor" href="#_step_3_the_select_clause"></a>5.3. Step 3. The SELECT clause</h3>
<div class="paragraph">
<p>Writing a <code>SELECT</code> clause depends on determining:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>What return data is required. The afore-mentioned scenario requires abnormal blood pressure values as return values, including both systolic pressure and diastolic pressure.</p>
</li>
<li>
<p>Write the appropriate identified path to the required item (variable name is required if the containing object is required). Multiple identified paths are separated using commas. For this particular scenario, two identified paths are found for systolic and diastolic data value by following Step 2. The completed query statement looks as follows:</p>
<div class="listingblock">
<div class="content">
<pre>SELECT
   obs/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude,
   obs/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude
FROM
   EHR [ehr_id/value=$ehrUid] CONTAINS COMPOSITION [openEHR-EHR-COMPOSITION.encounter.v1]
      CONTAINS OBSERVATION obs [openEHR-EHR-OBSERVATION.blood_pressure.v1]
WHERE
   obs/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude &gt;= 140 OR
   obs/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude &gt;= 90</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_ordering_and_pagination"><a class="anchor" href="#_ordering_and_pagination"></a>5.4. Ordering and pagination</h3>
<div class="paragraph">
<p>If the query scenario would be:</p>
</div>
<div class="paragraph">
<p><strong>"Get the latest 5 abnormal blood pressure values that were recorded in a health encounter for a specific patient."</strong></p>
</div>
<div class="paragraph">
<p>then the followings are needed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>add an extra column with event start_time values and order the results based on that column:</p>
<div class="listingblock">
<div class="content">
<pre>SELECT
   obs/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude AS systolic,
   obs/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude AS diastlic,
   c/context/start_time AS date_time
FROM
   EHR [ehr_id/value=$ehrUid] CONTAINS COMPOSITION c [openEHR-EHR-COMPOSITION.encounter.v1]
      CONTAINS OBSERVATION obs [openEHR-EHR-OBSERVATION.blood_pressure.v1]
WHERE
   obs/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude &gt;= 140 OR
   obs/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude &gt;= 90
ORDER BY
   c/context/start_time DESC</pre>
</div>
</div>
</li>
<li>
<p>use <code>LIMIT</code> clause to retrieve only the first needed rows, i.e. the latest 5 rows:</p>
<div class="listingblock">
<div class="content">
<pre>SELECT
   obs/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude AS systolic,
   obs/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude AS diastlic,
   c/context/start_time AS date_time
FROM
   EHR [ehr_id/value=$ehrUid] CONTAINS COMPOSITION c [openEHR-EHR-COMPOSITION.encounter.v1]
      CONTAINS OBSERVATION obs [openEHR-EHR-OBSERVATION.blood_pressure.v1]
WHERE
   obs/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude &gt;= 140 OR
   obs/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude &gt;= 90
ORDER BY
   c/context/start_time DESC
LIMIT 5</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aql_syntax_specification"><a class="anchor" href="#_aql_syntax_specification"></a>6. AQL Syntax Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following Antlr grammar expresses the AQL syntax.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="antlr-java"><span></span><span class="tok-c">// Author: Bostjan Lah</span><span class="tok-w"></span>
<span class="tok-c">// (c) Copyright, Marand, http://www.marand.com</span><span class="tok-w"></span>
<span class="tok-c">// Licensed under LGPL: http://www.gnu.org/copyleft/lesser.html</span><span class="tok-w"></span>
<span class="tok-c">// Based on AQL grammar by Ocean Informatics: http://www.openehr.org/wiki/download/attachments/2949295/EQL_v0.6.grm?version=1&amp;modificationDate=1259650833000</span><span class="tok-w"></span>
<span class="tok-k">grammar</span><span class="tok-w"> </span><span class="tok-nc">Aql</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">options</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-nv">output</span><span class="tok-p">=</span>AST<span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-nv">ASTLabelType</span><span class="tok-p">=</span>CommonTree<span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-nv">backtrack</span><span class="tok-p">=</span>true<span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-nv">memoize</span><span class="tok-p">=</span>true<span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">tokens</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-nl">ORDERDESC</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-nl">ORDERASC</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-nl">@header</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-kn">package</span> <span class="tok-nn">com.marand.thinkehr.aql.antlr</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">com.marand.thinkehr.aql.AqlRecognitionException</span><span class="tok-o">;</span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-nl">@lexer</span><span class="tok-p">::</span><span class="tok-nl">header</span><span class="tok-p">{</span>
<span class="tok-kn">package</span> <span class="tok-nn">com.marand.thinkehr.aql.antlr</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">com.marand.thinkehr.aql.AqlRecognitionException</span><span class="tok-o">;</span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-nl">@members</span><span class="tok-p">{</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">displayRecognitionError</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">tokenNames</span><span class="tok-o">,</span> <span class="tok-n">RecognitionException</span> <span class="tok-n">e</span><span class="tok-o">)</span>
<span class="tok-p">{</span>
  <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">AqlRecognitionException</span><span class="tok-o">(</span><span class="tok-n">e</span><span class="tok-o">);</span>
<span class="tok-p">}</span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-c">// Rule Definitions</span><span class="tok-w"></span>
<span class="tok-c">//&lt;Query&gt; ::= &lt;Select&gt; &lt;From&gt;</span><span class="tok-w"></span>
<span class="tok-c">//           | &lt;Select&gt; &lt;From&gt; &lt;Where&gt;</span><span class="tok-w"></span>
<span class="tok-c">//            | &lt;Select&gt; &lt;From&gt; &lt;OrderBy&gt;   ! is this allowed?</span><span class="tok-w"></span>
<span class="tok-c">//            | &lt;Select&gt; &lt;From&gt; &lt;OrderBy&gt; &lt;Limit&gt;</span><span class="tok-w"></span>
<span class="tok-c">//            | &lt;Select&gt; &lt;From&gt; &lt;Where&gt; &lt;OrderBy&gt;</span><span class="tok-w"></span>
<span class="tok-c">//            | &lt;Select&gt; &lt;From&gt; &lt;Where&gt; &lt;OrderBy&gt; &lt;Limit&gt;</span><span class="tok-w"></span>
<span class="tok-nl">query</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-nv">select</span><span class="tok-w"> </span><span class="tok-nv">from</span><span class="tok-w"> </span><span class="tok-nv">where</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-nv">orderBy</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-nv">limit</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-s">&#39;;&#39;</span><span class="tok-o">!?</span><span class="tok-w"> </span><span class="tok-no">EOF</span><span class="tok-o">!</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;Select&gt; ::= &#39;SELECT&#39; &lt;SelectExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//         | &#39;SELECT&#39; &lt;TOP&gt; &lt;SelectExpr&gt;   deprecated!</span><span class="tok-w"></span>
<span class="tok-nl">select</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">SELECT</span><span class="tok-w"> </span><span class="tok-nv">top</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-nv">selectExpr</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">SELECT</span><span class="tok-w"> </span><span class="tok-nv">top</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-nv">selectExpr</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">// (deprecated)</span><span class="tok-w"></span>
<span class="tok-c">//&lt;Top&gt; ::= &#39;TOP&#39; Integer</span><span class="tok-w"></span>
<span class="tok-c">//          | &#39;TOP&#39; Integer &#39;BACKWARD&#39;</span><span class="tok-w"></span>
<span class="tok-c">//          | &#39;TOP&#39; Integer &#39;FORWARD&#39;</span><span class="tok-w"></span>
<span class="tok-nl">top</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">TOP</span><span class="tok-w"> </span><span class="tok-no">INTEGER</span><span class="tok-w"> </span><span class="tok-no">FORWARD</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">TOP</span><span class="tok-w"> </span><span class="tok-no">INTEGER</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-o">|</span><span class="tok-w">	</span><span class="tok-no">TOP</span><span class="tok-w"> </span><span class="tok-no">INTEGER</span><span class="tok-w"> </span><span class="tok-no">BACKWARD</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">TOP</span><span class="tok-w"> </span><span class="tok-no">INTEGER</span><span class="tok-w"> </span><span class="tok-no">BACKWARD</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>


<span class="tok-c">//&lt;Where&gt; ::= &#39;WHERE&#39; &lt;IdentifiedExpr&gt;</span><span class="tok-w"></span>
<span class="tok-nl">where</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">WHERE</span><span class="tok-w"> </span><span class="tok-nv">identifiedExpr</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">WHERE</span><span class="tok-w"> </span><span class="tok-nv">identifiedExpr</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;OrderBy&gt; ::= &#39;ORDER BY&#39; &lt;OrderBySeq&gt;</span><span class="tok-w"></span>
<span class="tok-nl">orderBy</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">ORDERBY</span><span class="tok-w"> </span><span class="tok-nv">orderBySeq</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">ORDERBY</span><span class="tok-w"> </span><span class="tok-nv">orderBySeq</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;OrderBySeq&gt;  ::= &lt;OrderByExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//		| &lt;OrderByExpr&gt; &#39;,&#39; &lt;OrderBySeq&gt;</span><span class="tok-w"></span>
<span class="tok-nl">orderBySeq</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-nv">orderByExpr</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;,&#39;</span><span class="tok-o">!</span><span class="tok-w"> </span><span class="tok-nv">orderByExpr</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;OrderByExpr&gt; ::= &lt;IdentifiedPath&gt;</span><span class="tok-w"></span>
<span class="tok-c">//		| &lt;IdentifiedPath&gt; &#39;DESCENDING&#39;</span><span class="tok-w"></span>
<span class="tok-c">//		| &lt;IdentifiedPath&gt; &#39;ASCENDING&#39;</span><span class="tok-w"></span>
<span class="tok-c">//		| &lt;IdentifiedPath&gt; &#39;DESC&#39;</span><span class="tok-w"></span>
<span class="tok-c">//		| &lt;IdentifiedPath&gt; &#39;ASC&#39;</span><span class="tok-w"></span>
<span class="tok-nl">orderByExpr</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-nv">identifiedPath</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">DESCENDING</span><span class="tok-o">|</span><span class="tok-no">DESC</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">ORDERDESC</span><span class="tok-w"> </span><span class="tok-nv">identifiedPath</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-o">|</span><span class="tok-w">	</span><span class="tok-nv">identifiedPath</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">ASCENDING</span><span class="tok-o">|</span><span class="tok-no">ASC</span><span class="tok-o">)?</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">ORDERASC</span><span class="tok-w"> </span><span class="tok-nv">identifiedPath</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;Limit&gt; ::= &#39;LIMIT&#39; NonNegativeInteger</span><span class="tok-w"></span>
<span class="tok-c">//          | &#39;LIMIT&#39; NonNegativeInteger &#39;OFFSET&#39; NonNegativeInteger</span><span class="tok-w"></span>
<span class="tok-nl">limit</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">LIMIT</span><span class="tok-w"> </span><span class="tok-no">NN_INTEGER</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">LIMIT</span><span class="tok-w"> </span><span class="tok-no">NN_INTEGER</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">LIMIT</span><span class="tok-w"> </span><span class="tok-no">NN_INTEGER</span><span class="tok-w"> </span><span class="tok-no">OFFSET</span><span class="tok-w"> </span><span class="tok-no">NN_INTEGER</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">LIMIT</span><span class="tok-w"> </span><span class="tok-no">NN_INTEGER</span><span class="tok-w"> </span><span class="tok-no">OFFSET</span><span class="tok-w"> </span><span class="tok-no">NN_INTEGER</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;SelectExpr&gt; ::= &lt;IdentifiedPathSeq&gt;</span><span class="tok-w"></span>
<span class="tok-nl">selectExpr</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-nv">identifiedPathSeq</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//! When multiple paths provided, each IdentifiedPath must represent an object of type DataValue</span><span class="tok-w"></span>
<span class="tok-c">//&lt;IdentifiedPathSeq&gt; ::= &lt;IdentifiedPath//&gt;</span><span class="tok-w"></span>
<span class="tok-c">//			| &lt;IdentifiedPath&gt; &#39;as&#39; Identifier</span><span class="tok-w"></span>
<span class="tok-c">//			| &lt;IdentifiedPath&gt; &#39;,&#39; &lt;IdentifiedPathSeq&gt;</span><span class="tok-w"></span>
<span class="tok-c">//			| &lt;IdentifiedPath&gt; &#39;as&#39; Identifier &#39;,&#39; &lt;IdentifiedPathSeq&gt;</span><span class="tok-w"></span>
<span class="tok-nl">identifiedPathSeq</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-nv">selectVar</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;,&#39;</span><span class="tok-o">!</span><span class="tok-w"> </span><span class="tok-nv">selectVar</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">selectVar</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-nv">identifiedPath</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">asIdentifier</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">asIdentifier</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">AS</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;From&gt; ::=   &#39;FROM&#39; &lt;FromExpr&gt;		! stop or/and without root class</span><span class="tok-w"></span>
<span class="tok-c">//	    | &#39;FROM&#39; &lt;FromEHR&gt; &lt;ContainsExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//           | &#39;FROM&#39; &lt;FromEHR&gt;</span><span class="tok-w"></span>
<span class="tok-c">//!          &#39;FROM&#39; &lt;ContainsOr&gt;</span><span class="tok-w"></span>
<span class="tok-nl">from</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">FROM</span><span class="tok-w"> </span><span class="tok-nv">fromExpr</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">FROM</span><span class="tok-w"> </span><span class="tok-nv">fromExpr</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">FROM</span><span class="tok-w"> </span><span class="tok-nv">ehrContains</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">FROM</span><span class="tok-w"> </span><span class="tok-nv">ehrContains</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;FromEHR&gt; ::= &#39;EHR&#39; &lt;StandardPredicate&gt;</span><span class="tok-w"></span>
<span class="tok-c">//              | &#39;EHR&#39; Identifier &lt;StandardPredicate&gt;</span><span class="tok-w"></span>
<span class="tok-c">//              | &#39;EHR&#39; Identifier</span><span class="tok-w"></span>
<span class="tok-nl">fromEHR</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">EHR</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">EHR</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">EHR</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-w"> </span><span class="tok-nv">standardPredicate</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">EHR</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-w"> </span><span class="tok-nv">standardPredicate</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">EHR</span><span class="tok-w"> </span><span class="tok-nv">standardPredicate</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">EHR</span><span class="tok-w"> </span><span class="tok-nv">standardPredicate</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">ehrContains</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">fromEHR</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">CONTAINS</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">contains</span><span class="tok-o">)?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;IdentifiedExpr&gt; ::= &lt;IdentifiedEquality&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                   | &lt;IdentifiedExprBoolean&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                   |&#39;(&#39; &lt;IdentifiedExprBoolean&gt; &#39;)&#39;</span><span class="tok-w"></span>
<span class="tok-c">//identifiedExpr</span><span class="tok-w"></span>
<span class="tok-c">//	: identifiedExprBoolean;</span><span class="tok-w"></span>
<span class="tok-c">//        | &#39;(&#39;! identifiedExprBoolean &#39;)&#39;!;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;IdentifiedExprBoolean&gt; ::= &lt;IdentifiedExpr&gt; &#39;OR&#39; &lt;IdentifiedExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                              | &lt;IdentifiedExpr&gt; &#39;AND&#39; &lt;IdentifiedExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                              | &#39;NOT&#39;&#39;(&#39; &lt;IdentifiedExprBoolean&gt; &#39;)&#39;</span><span class="tok-w"></span>
<span class="tok-c">//                              | &#39;NOT&#39; &lt;IdentifiedEquality&gt;</span><span class="tok-w"></span>
<span class="tok-nl">identifiedExpr</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">identifiedExprAnd</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">OR</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">identifiedExprAnd</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">identifiedExprAnd</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">identifiedEquality</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">AND</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">identifiedEquality</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>


<span class="tok-c">//&lt;IdentifiedEquality&gt; ::= &lt;IdentifiedOperand&gt; ComparableOperator &lt;IdentifiedOperand&gt;</span><span class="tok-w"></span>
<span class="tok-c">//			     | &lt;IdentifiedOperand&gt; &#39;LIKE&#39; LikePattern</span><span class="tok-w"></span>
<span class="tok-c">//			     | &lt;IdentifiedOperand&gt; &#39;matches&#39; &#39;{&#39; &lt;MatchesOperand&gt; &#39;}&#39;</span><span class="tok-w"></span>
<span class="tok-c">//                          | &#39;EXISTS&#39; &lt;IdentifiedPath&gt;</span><span class="tok-w"></span>
<span class="tok-nl">identifiedEquality</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">identifiedOperand</span><span class="tok-w"> </span><span class="tok-o">((</span><span class="tok-no">LIKE</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-no">LIKEPATTERN</span><span class="tok-o">)|(</span><span class="tok-no">MATCHES</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-s">&#39;{&#39;</span><span class="tok-o">!</span><span class="tok-w"> </span><span class="tok-nv">matchesOperand</span><span class="tok-w"> </span><span class="tok-s">&#39;}&#39;</span><span class="tok-o">!)|(</span><span class="tok-no">COMPARABLEOPERATOR</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">identifiedOperand</span><span class="tok-o">))</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">EXISTS</span><span class="tok-w"> </span><span class="tok-nv">identifiedPath</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">EXISTS</span><span class="tok-w"> </span><span class="tok-nv">identifiedPath</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;(&#39;</span><span class="tok-o">!</span><span class="tok-w"> </span><span class="tok-nv">identifiedExpr</span><span class="tok-w"> </span><span class="tok-s">&#39;)&#39;</span><span class="tok-o">!</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">NOT</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">identifiedEquality</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;IdentifiedOperand&gt; ::= &lt;Operand&gt; | &lt;IdentifiedPath&gt;</span><span class="tok-w"></span>
<span class="tok-nl">identifiedOperand</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">operand</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">identifiedPath</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-c">//!&lt;IdentifiedOperand&gt; ::= &lt;Operand&gt; | &lt;RelativePath&gt;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;IdentifiedPath&gt;::= Identifier</span><span class="tok-w"></span>
<span class="tok-c">//                    | Identifier &lt;Predicate&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                    | Identifier &#39;/&#39; &lt;ObjectPath&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                    | Identifier &lt;Predicate&gt; &#39;/&#39; &lt;ObjectPath&gt;</span><span class="tok-w"></span>
<span class="tok-nl">identifiedPath</span><span class="tok-w"></span>
<span class="tok-w">	 </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-w"> </span><span class="tok-nv">predicate</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;/&#39;</span><span class="tok-w"> </span><span class="tok-nv">objectPath</span><span class="tok-o">)?</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">IDENTIFIER</span><span class="tok-w"> </span><span class="tok-nv">predicate</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-nv">objectPath</span><span class="tok-o">?)</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-c">//!		| Identifer &lt;AbsolutePath&gt;</span><span class="tok-w"></span>
<span class="tok-c">//!		| Identifer &lt;Predicate&gt; &lt;AbsolutePath&gt;</span><span class="tok-w"></span>


<span class="tok-c">//&lt;Predicate&gt; ::= &lt;NodePredicate&gt;</span><span class="tok-w"></span>
<span class="tok-nl">predicate</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">nodePredicate</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;NodePredicate&gt; ::= &#39;[&#39;&lt;NodePredicateOr&gt;&#39;]&#39;</span><span class="tok-w"></span>
<span class="tok-nl">nodePredicate</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">OPENBRACKET</span><span class="tok-w"> </span><span class="tok-nv">nodePredicateOr</span><span class="tok-w"> </span><span class="tok-no">CLOSEBRACKET</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;NodePredicateOr&gt; ::= &lt;NodePredicateAnd&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                 | &lt;NodePredicateOr&gt; &#39;or&#39; &lt;NodePredicateAnd&gt;</span><span class="tok-w"></span>
<span class="tok-nl">nodePredicateOr</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">nodePredicateAnd</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">OR</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">nodePredicateAnd</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;NodePredicateAnd&gt; ::= &lt;NodePredicateComparable&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                 | &lt;NodePredicateAnd&gt; &#39;and&#39; &lt;NodePredicateComparable&gt;</span><span class="tok-w"></span>
<span class="tok-nl">nodePredicateAnd</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">nodePredicateComparable</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">AND</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">nodePredicateComparable</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;NodePredicateComparable&gt; ::= &lt;PredicateOperand&gt; ComparableOperator &lt;PredicateOperand&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                          | NodeId</span><span class="tok-w"></span>
<span class="tok-c">//                          | NodeId &#39;,&#39; String        ! &lt;NodeId&gt; and name/value = &lt;String&gt; shortcut</span><span class="tok-w"></span>
<span class="tok-c">//                          | NodeId &#39;,&#39; parameter     ! &lt;NodeId&gt; and name/value = &lt;Parameter&gt; shortcut</span><span class="tok-w"></span>
<span class="tok-c">//                          | RegExPattern             ! /items[{/at0001.*/}]</span><span class="tok-w"></span>
<span class="tok-c">//                          | &lt;PredicateOperand&gt; &#39;matches&#39; RegExPattern     ! /items[at0001 and name/value matches {//}]</span><span class="tok-w"></span>
<span class="tok-c">//                          | ArchetypeId</span><span class="tok-w"></span>
<span class="tok-c">//                          | ArchetypeId &#39;,&#39; String        ! &lt;NodeId&gt; and name/value = &lt;String&gt; shortcut</span><span class="tok-w"></span>
<span class="tok-c">//                          | ArchetypeId &#39;,&#39; parameter     ! &lt;NodeId&gt; and name/value = &lt;Parameter&gt; shortcut</span><span class="tok-w"></span>
<span class="tok-nl">nodePredicateComparable</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">NODEID</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">COMMA</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">STRING</span><span class="tok-o">|</span><span class="tok-no">PARAMETER</span><span class="tok-o">))?</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">ARCHETYPEID</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">COMMA</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">STRING</span><span class="tok-o">|</span><span class="tok-no">PARAMETER</span><span class="tok-o">))?</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">predicateOperand</span><span class="tok-w"> </span><span class="tok-o">((</span><span class="tok-no">COMPARABLEOPERATOR</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">predicateOperand</span><span class="tok-o">)|(</span><span class="tok-no">MATCHES</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-no">REGEXPATTERN</span><span class="tok-o">))</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">REGEXPATTERN</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;MatchesOperand&gt; ::= &lt;ValueListItems&gt;</span><span class="tok-w"></span>
<span class="tok-c">//			| UriValue</span><span class="tok-w"></span>
<span class="tok-nl">matchesOperand</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">valueListItems</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">URIVALUE</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//! &lt;ValueList&gt; ::= &#39;{&#39;&lt;ValueListItems&gt;&#39;}&#39;</span><span class="tok-w"></span>
<span class="tok-c">//&lt;ValueListItems&gt; ::= &lt;Operand&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                     |&lt;Operand&gt; &#39;,&#39; &lt;ValueListItems&gt;</span><span class="tok-w"></span>
<span class="tok-nl">valueListItems</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">operand</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;,&#39;</span><span class="tok-o">!</span><span class="tok-w"> </span><span class="tok-nv">operand</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;URI&gt;     ::= &#39;{&#39; UriValue &#39;}&#39;</span><span class="tok-w"></span>
<span class="tok-nl">uri</span><span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;{&#39;</span><span class="tok-w"> </span><span class="tok-no">URIVALUE</span><span class="tok-w"> </span><span class="tok-s">&#39;}&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>


<span class="tok-c">//&lt;ArchetypePredicate&gt; ::= &#39;[&#39; ArchetypeId &#39;]&#39;</span><span class="tok-w"></span>
<span class="tok-c">//			 | &#39;[&#39; Parameter &#39;]&#39;</span><span class="tok-w"></span>
<span class="tok-c">//                      | &#39;[&#39; RegExPattern &#39;]&#39;</span><span class="tok-w"></span>
<span class="tok-nl">archetypePredicate</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">OPENBRACKET</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-nv">archetypeId</span><span class="tok-o">|</span><span class="tok-no">PARAMETER</span><span class="tok-o">|</span><span class="tok-no">REGEXPATTERN</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-no">CLOSEBRACKET</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">archetypeId</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">ARCHETYPEID</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;VersionPredicate&gt; ::= &#39;[&#39; &lt;VersionPredicateOptions&gt; &#39;]&#39;</span><span class="tok-w"></span>
<span class="tok-nl">versionPredicate</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">OPENBRACKET</span><span class="tok-w"> </span><span class="tok-nv">versionPredicateOptions</span><span class="tok-w"> </span><span class="tok-no">CLOSEBRACKET</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;VersionPredicateOptions&gt; ::= &#39;latest_version&#39; | &#39;all_versions&#39;</span><span class="tok-w"></span>
<span class="tok-nl">versionPredicateOptions</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;latest_version&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">ALL_VERSIONS</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;StandardPredicate&gt; ::= &#39;[&#39; &lt;PredicateExpr&gt; &#39;]&#39;</span><span class="tok-w"></span>
<span class="tok-nl">standardPredicate</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;[&#39;</span><span class="tok-o">!</span><span class="tok-w"> </span><span class="tok-nv">predicateExpr</span><span class="tok-w"> </span><span class="tok-s">&#39;]&#39;</span><span class="tok-o">!</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;PredicateExpr&gt; ::= &lt;PredicateOr&gt;</span><span class="tok-w"></span>
<span class="tok-nl">predicateExpr</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">predicateOr</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;PredicateOr&gt; ::= &lt;PredicateAnd&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                 | &lt;PredicateOr&gt; &#39;or&#39; &lt;PredicateAnd&gt;</span><span class="tok-w"></span>
<span class="tok-nl">predicateOr</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">predicateAnd</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">OR</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">predicateAnd</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-c">// 	: (predicateOr &#39;or&#39;)? predicateAnd; !!!</span><span class="tok-w"></span>

<span class="tok-c">//&lt;PredicateAnd&gt; ::= &lt;PredicateEquality&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                 | &lt;PredicateAnd&gt; &#39;and&#39; &lt;PredicateEquality&gt;</span><span class="tok-w"></span>
<span class="tok-nl">predicateAnd</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">predicateEquality</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">AND</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">predicateEquality</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-c">// 	: (predicateAnd &#39;and&#39;)? predicateEquality; !!!</span><span class="tok-w"></span>

<span class="tok-c">//&lt;PredicateEquality&gt; ::= &lt;PredicateOperand&gt; ComparableOperator &lt;PredicateOperand&gt;</span><span class="tok-w"></span>
<span class="tok-nl">predicateEquality</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">predicateOperand</span><span class="tok-w"> </span><span class="tok-no">COMPARABLEOPERATOR</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">predicateOperand</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;PredicateOperand&gt; ::= !Identifier</span><span class="tok-w"></span>
<span class="tok-c">//			!| Identifier PathItem</span><span class="tok-w"></span>
<span class="tok-c">//                     | &lt;ObjectPath&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                     | &lt;Operand&gt;</span><span class="tok-w"></span>
<span class="tok-nl">predicateOperand</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">objectPath</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">operand</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;Operand&gt; ::= String | Integer | Float | Date | Parameter | Boolean</span><span class="tok-w"></span>
<span class="tok-nl">operand</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">STRING</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">INTEGER</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">FLOAT</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">DATE</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">PARAMETER</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">BOOLEAN</span><span class="tok-p">;</span><span class="tok-w"></span>


<span class="tok-c">//&lt;ObjectPath&gt; ::=  &lt;PathPart&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                | &lt;PathPart&gt; &#39;/&#39; &lt;ObjectPath&gt;</span><span class="tok-w"></span>
<span class="tok-nl">objectPath</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">pathPart</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;/&#39;</span><span class="tok-w"> </span><span class="tok-nv">pathPart</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>


<span class="tok-c">//&lt;PathPart&gt; ::= Identifier</span><span class="tok-w"></span>
<span class="tok-c">//           | Identifier &lt;Predicate&gt;</span><span class="tok-w"></span>
<span class="tok-nl">pathPart</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-w"> </span><span class="tok-nv">predicate</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;FromExpr&gt; ::=  &lt;SimpleClassExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//		| &lt;SimpleClassExpr&gt; &lt;ContainsExpr&gt;</span><span class="tok-w"></span>
<span class="tok-nl">fromExpr</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">containsExpression</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">contains</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-nv">simpleClassExpr</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">CONTAINS</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">containsExpression</span><span class="tok-o">)?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//! Check thislass</span><span class="tok-w"></span>
<span class="tok-c">//&lt;ContainsExpr&gt;::= &#39;CONTAINS&#39; &lt;ContainsExpression&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                  !&#39;CONTAINS&#39; &lt;ContainsOr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//&lt;ContainsExpression&gt; ::= &lt;ClassExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                        | &lt;ContainExpressionBoolean&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                        |&#39;(&#39; &lt;ContainExpressionBoolean&gt; &#39;)&#39;</span><span class="tok-w"></span>
<span class="tok-nl">containsExpression</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">containExpressionBool</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-nv">boolOp</span><span class="tok-w"> </span><span class="tok-nv">containsExpression</span><span class="tok-o">)?</span><span class="tok-w"></span>
<span class="tok-c">// 	| &#39;(&#39; containExpressionBool &#39;)&#39; -&gt; ^(OPEN containExpressionBool)</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;ContainExpressionBoolean&gt; ::= &lt;ContainsExpression&gt; &#39;OR&#39; &lt;ContainsExpression&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                              | &lt;ContainsExpression&gt; &#39;AND&#39; &lt;ContainsExpression&gt;</span><span class="tok-w"></span>
<span class="tok-nl">containExpressionBool</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">contains</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;(&#39;</span><span class="tok-w"> </span><span class="tok-nv">containsExpression</span><span class="tok-w"> </span><span class="tok-s">&#39;)&#39;</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">OPEN</span><span class="tok-w"> </span><span class="tok-nv">containsExpression</span><span class="tok-w"> </span><span class="tok-no">CLOSE</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">boolOp</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">OR</span><span class="tok-o">|</span><span class="tok-no">AND</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;ClassExpr&gt;::=   &lt;SimpleClassExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//		   | &#39;(&#39; &lt;SimpleClassExpr&gt; &lt;ContainsExpr&gt; &#39;)&#39;</span><span class="tok-w"></span>
<span class="tok-c">//		   | &lt;SimpleClassExpr&gt; &lt;ContainsExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//classExpr</span><span class="tok-w"></span>
<span class="tok-c">// 	: &#39;(&#39; simpleClassExpr &#39;)&#39;</span><span class="tok-w"></span>
<span class="tok-c">//	| simpleClassExpr</span><span class="tok-w"></span>
<span class="tok-c">//	;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;SimpleClassExpr&gt;::= Identifier							! RM_TYPE_NAME</span><span class="tok-w"></span>
<span class="tok-c">//               | Identifier Identifier					! RM_TYPE_NAME variable</span><span class="tok-w"></span>
<span class="tok-c">//               | &lt;ArchetypedClassExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//		 | &lt;VersionedClassExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//		 | &lt;VersionClassExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//		 ! | &lt;IdentifiedObjectExpr&gt;                           ! need to be used once VersionedClassExpr is removed</span><span class="tok-w"></span>
<span class="tok-nl">simpleClassExpr</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-o">?</span><span class="tok-w">					</span><span class="tok-c">//! RM_TYPE_NAME .. RM_TYPE_NAME variable</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">archetypedClassExpr</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">versionedClassExpr</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">versionClassExpr</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-c">//		 ! | &lt;IdentifiedObjectExpr&gt;                           ! need to be used once VersionedClassExpr is removed</span><span class="tok-w"></span>

<span class="tok-c">//&lt;ArchetypedClassExpr&gt;::= Identifier &lt;ArchetypePredicate&gt;	! RM_TYPE_NAME [archetype_id]</span><span class="tok-w"></span>
<span class="tok-c">//               | Identifier Identifier &lt;ArchetypePredicate&gt;	! RM_TYPE_NAME variable [archetype_id]</span><span class="tok-w"></span>
<span class="tok-nl">archetypedClassExpr</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-nv">archetypePredicate</span><span class="tok-p">;</span><span class="tok-w">	</span><span class="tok-c">//! RM_TYPE_NAME variable? [archetype_id]</span><span class="tok-w"></span>

<span class="tok-c">//! need to be used once VersionedClassExpr is removed</span><span class="tok-w"></span>
<span class="tok-c">//!&lt;IdentifiedObjectExpr&gt;::= Identifier &lt;StandardPredicate&gt;	! RM_TYPE_NAME [path operator operand]</span><span class="tok-w"></span>
<span class="tok-c">//!               | Identifier Identifier &lt;StandardPredicate&gt;	! RM_TYPE_NAME variable [path operator operand]</span><span class="tok-w"></span>
<span class="tok-c">//&lt;VersionedClassExpr&gt;::= &#39;VERSIONED_OBJECT&#39;</span><span class="tok-w"></span>
<span class="tok-c">//               | &#39;VERSIONED_OBJECT&#39; Identifier</span><span class="tok-w"></span>
<span class="tok-c">//               | &#39;VERSIONED_OBJECT&#39; &lt;StandardPredicate&gt;</span><span class="tok-w"></span>
<span class="tok-c">//               | &#39;VERSIONED_OBJECT&#39; Identifier &lt;StandardPredicate&gt;</span><span class="tok-w"></span>
<span class="tok-nl">versionedClassExpr</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">VERSIONED_OBJECT</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-nv">standardPredicate</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;VersionClassExpr&gt;::= &#39;VERSION&#39;</span><span class="tok-w"></span>
<span class="tok-c">//               | &#39;VERSION&#39; Identifier</span><span class="tok-w"></span>
<span class="tok-c">//               | &#39;VERSION&#39; &lt;StandardPredicate&gt;</span><span class="tok-w"></span>
<span class="tok-c">//               | &#39;VERSION&#39; Identifier &lt;StandardPredicate&gt;</span><span class="tok-w"></span>
<span class="tok-c">//		 | &#39;VERSION&#39; &lt;VersionPredicate&gt;</span><span class="tok-w"></span>
<span class="tok-c">//               | &#39;VERSION&#39; Identifier &lt;VersionPredicate&gt;</span><span class="tok-w"></span>
<span class="tok-nl">versionClassExpr</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">VERSION</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-nv">standardPredicate</span><span class="tok-o">|</span><span class="tok-nv">versionPredicate</span><span class="tok-o">)?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// LEXER PATTERNS</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>

<span class="tok-nl">WS</span><span class="tok-w">  </span><span class="tok-p">:</span><span class="tok-w">   </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-s">&#39; &#39;</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;\t&#39;</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;\r&#39;</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;\n&#39;</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-nv">$channel</span><span class="tok-o">=</span><span class="tok-n">HIDDEN</span><span class="tok-o">;</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">SELECT</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;L&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;l&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;T&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;t&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">TOP</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;T&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;t&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;O&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;o&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;P&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;p&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">FORWARD</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;F&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;f&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;O&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;o&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;W&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;w&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">BACKWARD</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;B&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;b&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;K&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;k&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;W&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;w&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">AS</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">CONTAINS</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;O&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;o&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;N&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;T&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;t&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;I&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;i&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;N&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">WHERE</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;W&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;w&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;H&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;h&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">ORDERBY</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;O&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;o&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39; &#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;B&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;b&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;Y&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;y&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">LIMIT</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;L&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;l&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;I&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;i&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;M&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;m&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;I&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;i&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;T&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;t&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">OFFSET</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;O&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;o&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;F&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;f&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;F&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;f&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;T&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;t&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">FROM</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;F&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;f&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;O&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;o&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;M&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;m&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">DESCENDING</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;N&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;I&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;i&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;N&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;G&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;g&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">ASCENDING</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;N&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;I&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;i&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;N&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;G&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;g&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">DESC</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">ASC</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">EHR</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;EHR&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">AND</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;N&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">OR</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;O&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;o&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">NOT</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;N&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;O&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;o&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;T&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;t&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">LIKE</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;L&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;l&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;I&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;i&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;K&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;k&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">MATCHES</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;M&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;m&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;T&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;t&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;H&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;h&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">EXISTS</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;X&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;x&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;I&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;i&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;T&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;t&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">VERSION</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;VERSION&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">VERSIONED_OBJECT</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;VERSIONED_OBJECT&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">ALL_VERSIONS</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;all_versions&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">ESC_SEQ</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">:</span><span class="tok-w">   </span><span class="tok-s">&#39;\\&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;b&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;t&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;f&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;\&quot;&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;\&#39;&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;\\&#39;</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w">   </span><span class="tok-no">UNICODE_ESC</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w">   </span><span class="tok-no">OCTAL_ESC</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">OCTAL_ESC</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">:</span><span class="tok-w">   </span><span class="tok-s">&#39;\\&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;0&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;3&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;0&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;7&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;0&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;7&#39;</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w">   </span><span class="tok-s">&#39;\\&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;0&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;7&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;0&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;7&#39;</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w">   </span><span class="tok-s">&#39;\\&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;0&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;7&#39;</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">UNICODE_ESC</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">:</span><span class="tok-w">   </span><span class="tok-s">&#39;\\&#39;</span><span class="tok-w"> </span><span class="tok-s">&#39;u&#39;</span><span class="tok-w"> </span><span class="tok-no">HEX_DIGIT</span><span class="tok-w"> </span><span class="tok-no">HEX_DIGIT</span><span class="tok-w"> </span><span class="tok-no">HEX_DIGIT</span><span class="tok-w"> </span><span class="tok-no">HEX_DIGIT</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">HEX_DIGIT</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;0&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;9&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;f&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;F&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">QUOTE</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;\&#39;&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">DIGIT</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;0&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;9&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">HEXCHAR</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	 </span><span class="tok-no">DIGIT</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;b&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;B&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;f&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;F&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">LETTER</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;z&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;Z&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">ALPHANUM</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">LETTER</span><span class="tok-o">|</span><span class="tok-no">DIGIT</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">LETTERMINUSA</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;b&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;z&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;B&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;Z&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">LETTERMINUST</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;u&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;z&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;U&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;Z&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">IDCHAR</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">ALPHANUM</span><span class="tok-o">|</span><span class="tok-s">&#39;_&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">IDCHARMINUST</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">LETTERMINUST</span><span class="tok-o">|</span><span class="tok-no">DIGIT</span><span class="tok-o">|</span><span class="tok-s">&#39;_&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">URISTRING</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">ALPHANUM</span><span class="tok-o">|</span><span class="tok-s">&#39;_&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;-&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;/&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;:&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;.&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;?&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;&amp;&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;%&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;$&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;#&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;@&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;!&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;+&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;=&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;*&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">REGEXCHAR</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">URISTRING</span><span class="tok-o">|</span><span class="tok-s">&#39;(&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;)&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;\\&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;^&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;{&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;}&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;]&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;[&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>


<span class="tok-c">// Terminal Definitions</span><span class="tok-w"></span>

<span class="tok-c">//Boolean     = &#39;true&#39; | &#39;false&#39;</span><span class="tok-w"></span>
<span class="tok-nl">BOOLEAN</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;true&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;false&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;TRUE&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;FALSE&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//!NodeId      = &#39;a&#39;&#39;t&#39;{Digit}{Digit}{Digit}{Digit}</span><span class="tok-w"></span>
<span class="tok-c">//! conflict with Identifier</span><span class="tok-w"></span>
<span class="tok-c">//!NodeId	     = &#39;at&#39;({Digit}{Digit}{Digit}{Digit}(&#39;.0&#39;*(&#39;.&#39;{NonZeroDigit}{Digit}*)+|(&#39;.&#39;{NonZeroDigit}{Digit}*)*)|&#39;0&#39;&#39;.0&#39;*(&#39;.&#39;{NonZeroDigit}{Digit}*)+|(&#39;.&#39;{NonZeroDigit}{Digit}*)+)</span><span class="tok-w"></span>
<span class="tok-c">//NodeId	     = &#39;at&#39;({Digit}+(&#39;.&#39;{Digit}+)*)</span><span class="tok-w"></span>
<span class="tok-c">//NODEID	:	&#39;at&#39; DIGIT+ (&#39;.&#39; DIGIT+)*;</span><span class="tok-w"></span>
<span class="tok-nl">NODEID</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;at&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+)*</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-c">// DIGIT DIGIT DIGIT DIGIT;</span><span class="tok-w"></span>

<span class="tok-c">//!Identifier  = {Letter}({Alphanumeric}|&#39;_&#39;)*   ! Conflicts with UID</span><span class="tok-w"></span>
<span class="tok-c">//!Identifier  = {Letter}{IdChar}*   ! Conflicts with extended NodeId</span><span class="tok-w"></span>
<span class="tok-c">//! restricted to allow only letters after the 4th character due to conflict with extended NodeId</span><span class="tok-w"></span>
<span class="tok-c">//!Identifier  = {Letter}{IdChar}?{IdChar}?{IdChar}?({Letter}|&#39;_&#39;)*  !Conficts with NodeId which may have any length of digit, such as at0.9</span><span class="tok-w"></span>
<span class="tok-c">//Identifier = {LetterMinusA}{IdCharMinusT}?{IdChar}* | &#39;a&#39;&#39;t&#39;?(({letter}|&#39;_&#39;)*|{LetterMinusT}{Alphanumeric}*)</span><span class="tok-w"></span>
<span class="tok-c">// ???</span><span class="tok-w"></span>
<span class="tok-nl">IDENTIFIER</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-o">(</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">ALPHANUM</span><span class="tok-o">|</span><span class="tok-s">&#39;_&#39;</span><span class="tok-o">)*</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-o">|</span><span class="tok-w"> 	</span><span class="tok-no">LETTERMINUSA</span><span class="tok-w"> </span><span class="tok-no">IDCHAR</span><span class="tok-o">*</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//!PathItem = &#39;/&#39;{Letter}({Alphanumeric}|&#39;_&#39;)*</span><span class="tok-w"></span>

<span class="tok-c">//Integer     = {Digit}+</span><span class="tok-w"></span>
<span class="tok-nl">INTEGER</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;-&#39;</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//NonNegativeInteger  = {Digit}+</span><span class="tok-w"></span>
<span class="tok-nl">NN_INTEGER</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">DIGIT</span><span class="tok-o">+</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//Float       = {Digit}+&#39;.&#39;{Digit}+</span><span class="tok-w"></span>
<span class="tok-nl">FLOAT</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;-&#39;</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//Date        = &#39;&#39;{Digit}{Digit}{Digit}{Digit}&#39;-&#39;{Digit}{Digit}&#39;-&#39;{Digit}{Digit}&#39;&#39;</span><span class="tok-w"></span>
<span class="tok-nl">DATE</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;\&#39;&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-s">&#39;T&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-s">&#39;+&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-s">&#39;\&#39;&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//!Parameter   = &#39;$&#39;{letter}({Alphanumeric}|&#39;_&#39;)*</span><span class="tok-w"></span>
<span class="tok-c">//Parameter   = &#39;$&#39;{letter}{IdChar}*</span><span class="tok-w"></span>
<span class="tok-nl">PARAMETER</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;$&#39;</span><span class="tok-w"> </span><span class="tok-no">LETTER</span><span class="tok-w"> </span><span class="tok-no">IDCHAR</span><span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//! could constrain UID further</span><span class="tok-w"></span>
<span class="tok-c">//UniqueId    = {digit}+(&#39;.&#39;{digit}+)+&#39;.&#39;{digit}+  ! OID</span><span class="tok-w"></span>
<span class="tok-c">//          | {Hex Char}+(&#39;-&#39;{Hex Char}+)+       ! UUID</span><span class="tok-w"></span>
<span class="tok-nl">UNIQUEID</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">DIGIT</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+)+</span><span class="tok-w"> </span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+</span><span class="tok-w">  </span><span class="tok-c">// OID</span><span class="tok-w"></span>
<span class="tok-w">            </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">HEXCHAR</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;-&#39;</span><span class="tok-w"> </span><span class="tok-no">HEXCHAR</span><span class="tok-o">+)+</span><span class="tok-w">       </span><span class="tok-c">// UUID</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//! could constrain ArchetypeId further</span><span class="tok-w"></span>
<span class="tok-c">//!ArchetypeId = {Letter}+&#39;-&#39;{Letter}+&#39;-&#39;({Letter}|&#39;_&#39;)+&#39;.&#39;({Letter}|&#39;_&#39;|&#39;-&#39;)+&#39;.v&#39;{Digit}+(&#39;.&#39;{Digit}+)?  ! not allow a number in archetype id concept, such as openEHR-EHR-OBSERVATION.laboratory-hba1c.v1</span><span class="tok-w"></span>
<span class="tok-c">//ArchetypeId = {Letter}+&#39;-&#39;{Letter}+&#39;-&#39;({Letter}|&#39;_&#39;)+&#39;.&#39;({IdChar}|&#39;-&#39;)+&#39;.v&#39;{Digit}+(&#39;.&#39;{Digit}+)?</span><span class="tok-w"></span>
<span class="tok-nl">ARCHETYPEID</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">LETTER</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&#39;-&#39;</span><span class="tok-w"> </span><span class="tok-no">LETTER</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&#39;-&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">LETTER</span><span class="tok-o">|</span><span class="tok-s">&#39;_&#39;</span><span class="tok-o">)+</span><span class="tok-w"> </span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">IDCHAR</span><span class="tok-o">|</span><span class="tok-s">&#39;-&#39;</span><span class="tok-o">)+</span><span class="tok-w"> </span><span class="tok-s">&#39;.v&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+)?</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//ComparableOperator = &#39;=&#39; | &#39;!=&#39; | &#39;&gt;&#39; | &#39;&gt;=&#39; | &#39;&lt;&#39; | &#39;&lt;=&#39;</span><span class="tok-w"></span>
<span class="tok-nl">COMPARABLEOPERATOR</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;=&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;!=&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;&gt;&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;&gt;=&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;&lt;&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;&lt;=&#39;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//UriValue   = {Letter}+&#39;://&#39;({UriString}|&#39;[&#39;|&#39;]&#39;|&#39;, &#39;&#39;&#39;|&#39;&#39;)*</span><span class="tok-w"></span>
<span class="tok-c">//            |{Letter}+&#39;:&#39;({UriString}|&#39;[&#39;|&#39;]&#39;|&#39;&#39;)*</span><span class="tok-w"></span>
<span class="tok-nl">URIVALUE</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">LETTER</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&#39;://&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">URISTRING</span><span class="tok-o">|</span><span class="tok-s">&#39;[&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;]&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;, \&#39;&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;\&#39;&#39;</span><span class="tok-o">)*</span><span class="tok-w"></span>
<span class="tok-c">//	| LETTER+ &#39;:&#39; (URISTRING|&#39;[&#39;|&#39;]&#39;|&#39;\&#39;&#39;)*</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//RegExPattern = &#39;{/&#39;{RegExChar}+&#39;/}&#39;</span><span class="tok-w"></span>
<span class="tok-nl">REGEXPATTERN</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;{/&#39;</span><span class="tok-w"> </span><span class="tok-no">REGEXCHAR</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&#39;/}&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//LikePattern = String</span><span class="tok-w"></span>
<span class="tok-nl">LIKEPATTERN</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">STRING</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//String      = &#39;&quot;&#39;{String Char}*&#39;&quot;&#39;</span><span class="tok-w"></span>
<span class="tok-w">  </span><span class="tok-c">//          | &#39;&#39;{String Char}*&#39;&#39;</span><span class="tok-w"></span>
<span class="tok-nl">STRING</span><span class="tok-w"></span>
<span class="tok-w">    	</span><span class="tok-p">:</span><span class="tok-w">  </span><span class="tok-s">&#39;\&#39;&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-no">ESC_SEQ</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-o">~(</span><span class="tok-s">&#39;\\&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;\&#39;&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-o">)*</span><span class="tok-w"> </span><span class="tok-s">&#39;\&#39;&#39;</span><span class="tok-w"></span>
<span class="tok-w">    	</span><span class="tok-o">|</span><span class="tok-w">  </span><span class="tok-s">&#39;&quot;&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-no">ESC_SEQ</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-o">~(</span><span class="tok-s">&#39;\\&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;&quot;&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-o">)*</span><span class="tok-w"> </span><span class="tok-s">&#39;&quot;&#39;</span><span class="tok-w"></span>
<span class="tok-w">    	</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">SLASH</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;/&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">COMMA</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;,&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">OPENBRACKET</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;[&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">CLOSEBRACKET</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;]&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">OPEN</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;(&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">CLOSE</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;)&#39;</span><span class="tok-p">;</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-12-14 20:46:10 UTC
</div>
</div>
<link rel="stylesheet" href="https://specifications.openehr.org/styles/pygments-default.css">
</body>
</html>